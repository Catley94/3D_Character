(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&s(f)}).observe(document,{childList:!0,subtree:!0});function o(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(i){if(i.ep)return;i.ep=!0;const c=o(i);fetch(i.href,c)}})();const a={IDLE:"idle",CLICKED:"clicked",LISTENING:"listening",TALKING:"talking"},n={currentState:a.IDLE,config:{},isTyping:!1,hasDragged:!1,isDragging:!1,isWindowLocked:!1};function ce(){console.log("[Interactions] Setting up click-through (Manual CSS Hover Mode)...");const e=document.getElementById("character"),t=document.getElementById("backpack"),o=document.getElementById("speech-bubble"),s=document.getElementById("chat-input-container"),i=document.getElementById("settings-panel"),c=document.getElementById("drag-handle"),f=document.getElementById("close-settings"),N=document.getElementById("save-settings");document.getElementById("character-container");const w=[{el:e,id:"character"},{el:t,id:"backpack"},{el:o,id:"speech-bubble"},{el:s,id:"chat-input-container"},{el:c,id:"drag-handle"},{el:f,id:"close-settings"},{el:N,id:"save-settings"}].filter(u=>!!u.el);console.log(`[Interactions] Tracking ${w.length} elements for manual hover`);function A(u,m,p){if(!p||p.classList.contains("hidden"))return!1;if(p.id==="settings-panel"&&!p.classList.contains("hidden"))return!0;const g=p.getBoundingClientRect();return u>=g.left&&u<=g.right&&m>=g.top&&m<=g.bottom}window.electronAPI.onCursorPosition(u=>{const{x:m,y:p}=u;let g=!1;i&&!i.classList.contains("hidden")&&(g=!0),w.forEach(se=>{const T=se.el;A(m,p,T)&&!n.isDragging?(T.classList.contains("manual-hover")||T.classList.add("manual-hover"),g=!0):(T.classList.contains("manual-hover")&&T.classList.remove("manual-hover"),n.isDragging&&(g=!0))}),n.isDragging||window.electronAPI.setOverInteractive(g)}),window.electronAPI.onCursorBoundsChanged(u=>{u.inBounds||(w.forEach(m=>{m.el&&m.el.classList.contains("manual-hover")&&m.el.classList.remove("manual-hover")}),window.electronAPI.setIgnoreMouseEvents(!0,{forward:!0}))}),window.addEventListener("mousemove",u=>{}),console.log("[Interactions] Setup complete - listening for cursor-position")}const b=document.getElementById("speech-bubble"),v=document.getElementById("bubble-text"),ae=document.getElementById("bubble-dismiss"),S=document.getElementById("chat-input-container"),d=document.getElementById("chat-input"),re=document.getElementById("send-btn"),de=180,le=60,ue=30,ge=200,me=320,_=15e3,he=6e4;let L=null,C=null;function fe(){re.addEventListener("click",G),d.addEventListener("keypress",e=>{e.key==="Enter"&&G()}),ae.addEventListener("click",()=>{Le()}),d.addEventListener("input",()=>{L&&(D(),L=setTimeout(()=>{q("Still there? I'm going to nap! ðŸ˜´")},_))})}function h(e,t=!0){b.classList.remove("hidden"),t?ye(e):(v.textContent=e,setTimeout(y,50))}function B(){b.classList.add("hidden"),v.textContent="",y()}function pe(){n.isWindowLocked=!0,window.electronAPI.setWindowLocked(!0),document.body.classList.add("window-locked")}function x(){n.isWindowLocked=!1,window.electronAPI.setWindowLocked(!1),document.body.classList.remove("window-locked")}function Ie(){let e=de;return b.classList.contains("hidden")||(e+=b.offsetHeight+10),S.classList.contains("hidden")||(e+=le),e+ue}function y(){const t=!b.classList.contains("hidden")||!S.classList.contains("hidden")?me:ge,o=Ie();window.electronAPI.setWindowSize(t,o)}async function ye(e){if(!n.isTyping){n.isTyping=!0;try{v.innerHTML="";const t=document.createElement("span");t.className="typing-cursor";for(let o=0;o<e.length&&!b.classList.contains("hidden");o++)v.textContent=e.substring(0,o+1),v.appendChild(t),o%10===0&&y(),await new Promise(s=>setTimeout(s,30+Math.random()*20));y(),setTimeout(()=>t.remove(),1e3)}catch(t){console.error("Typing error:",t),v.textContent=e}finally{n.isTyping=!1}}}function ve(){l(a.LISTENING),h("Hi there! What's up?"),Y()}function Y(){S.classList.remove("hidden"),d.focus(),y(),D(),L=setTimeout(()=>{q("Taking a quick nap... poke me anytime! ðŸ˜´")},_)}function X(){S.classList.add("hidden"),d.value="",D(),y()}function D(){L&&(clearTimeout(L),L=null)}function W(){C&&(clearTimeout(C),C=null)}function Le(){W(),B(),S.classList.contains("hidden")&&y()}function q(e){X(),B(),W(),e&&(h(e),C=setTimeout(B,3e3)),l(a.IDLE)}function Ee(){l(a.IDLE),W(),C=setTimeout(()=>{B(),X()},he)}async function G(){const e=d.value.trim();if(e){d.value="",d.disabled=!0,D(),pe(),l(a.LISTENING),h("Hmm, let me think... ðŸ¤”",!1);try{const t=await window.electronAPI.sendMessage(e,n.config);t.error?(l(a.TALKING),h(`Oops! ${t.error} ðŸ˜…`)):(l(a.TALKING),await h(t.response)),x(),d.disabled=!1,d.focus(),Ee()}catch(t){console.error("Error sending message:",t),l(a.TALKING),h("Something went wrong! ðŸ˜µ"),x(),setTimeout(()=>{d.disabled=!1,d.focus(),l(a.LISTENING)},2e3)}}}const z=document.getElementById("character"),r=document.getElementById("character-container"),k=document.getElementById("character-img"),P=document.getElementById("backpack"),be=document.getElementById("chat-input-container"),O=["Oh! I felt that! ðŸ˜Š How're you doing?","Hey there! *wiggles ears* What's up?","Ooh, a poke! Got something on your mind?","*blinks* Hello, friend! Need me?","Ah! You found me! ðŸ¦Š What can I do for you?"];let U,F,j,J;function we(){z.addEventListener("click",R),Q(n.config.theme||"fox"),r.addEventListener("pointerdown",Ce),r.addEventListener("pointermove",Be),r.addEventListener("pointerup",e=>{n.isDragging&&(n.isDragging=!1,window.electronAPI.setDragging(!1),document.body.classList.remove("is-dragging"),r.releasePointerCapture(e.pointerId),n.hasDragged||R(e))}),r.addEventListener("lostpointercapture",()=>{n.isDragging&&(n.isDragging=!1,window.electronAPI.setDragging(!1),document.body.classList.remove("is-dragging"))})}function l(e){n.currentState=e,z.className=`state-${e}`;const o=`themes/${n.config.theme||"fox"}`;switch(e){case a.CLICKED:k.src=`${o}/clicked.png`;break;case a.LISTENING:k.src=`${o}/listening.png`;break;case a.TALKING:k.src=`${o}/talking.png`;break;default:k.src=`${o}/idle.png`}}function Q(e){const t=`themes/${e}`;k.src=`${t}/idle.png`}function Te(){return O[Math.floor(Math.random()*O.length)]}function R(e){console.log("[Character] Clicked"),!(e.target===P||P.contains(e.target))&&(!be.classList.contains("hidden")||n.isTyping||n.hasDragged||ke())}function ke(){l(a.CLICKED),h(Te()),setTimeout(()=>{Y(),l(a.LISTENING)},1500)}let $=!1;function Ce(e){if(e.target===P||P.contains(e.target)||n.isWindowLocked)return;n.isDragging=!0,n.hasDragged=!1,U=e.clientX,F=e.clientY;const t=r.getBoundingClientRect();j=t.left,J=t.top,r.setPointerCapture(e.pointerId),window.electronAPI.setDragging(!0),document.body.classList.add("is-dragging"),window.electronAPI.setIgnoreMouseEvents(!1)}function Be(e){if(!n.isDragging)return;const t=e.clientX-U,o=e.clientY-F;(Math.abs(t)>3||Math.abs(o)>3)&&(n.hasDragged=!0);let s=j+t,i=J+o;const c=r.getBoundingClientRect(),f=c.width,N=c.height,w=window.innerWidth-f,A=window.innerHeight-N;s=Math.max(0,Math.min(s,w)),i=Math.max(0,Math.min(i,A)),$||($=!0,r.style.right="auto",r.style.bottom="auto"),r.style.left=`${s}px`,r.style.top=`${i}px`}const M=document.getElementById("settings-panel"),Se=document.getElementById("backpack"),Pe=document.getElementById("close-settings"),Me=document.getElementById("save-settings"),V=document.getElementById("api-provider"),Z=document.getElementById("api-key"),E=document.getElementById("gemini-model"),I=document.getElementById("custom-model-input"),ee=document.getElementById("character-name"),te=document.getElementById("theme-select"),ne=document.querySelectorAll("#personality-traits input"),oe=document.getElementById("debug-mode");function De(){Se.addEventListener("click",e=>{e.stopPropagation(),K()}),Pe.addEventListener("click",H),M.addEventListener("click",e=>{e.target===M&&H()}),Me.addEventListener("click",Ne),E.addEventListener("change",()=>{E.value==="custom"?(I.classList.remove("hidden"),I.focus()):I.classList.add("hidden")}),window.electronAPI.onOpenSettings(()=>K())}function ie(e){n.config=e,V.value=e.provider||"gemini",Z.value=e.apiKey||"";const t=e.geminiModel||"gemini-2.0-flash";!Array.from(E.options).some(s=>s.value===t)?(E.value="custom",I.value=t,I.classList.remove("hidden")):(E.value=t,I.classList.add("hidden")),ee.value=e.characterName||"Foxy",te.value=e.theme||"fox",ne.forEach(s=>{s.checked=(e.personality||["helpful","quirky","playful"]).includes(s.value)}),oe.checked=e.debugMode||!1,document.body.classList.toggle("debug-mode",e.debugMode||!1),Q(e.theme||"fox")}function K(){M.classList.remove("hidden")}function H(){M.classList.add("hidden")}async function Ne(){const e=[];ne.forEach(s=>{s.checked&&e.push(s.value)});let t=E.value;t==="custom"&&(t=I.value.trim()||"gemini-2.0-flash");const o={provider:V.value,apiKey:Z.value,geminiModel:t,characterName:ee.value,theme:te.value,personality:e,debugMode:oe.checked};await window.electronAPI.saveConfig(o),ie(o),H(),h("Settings saved! âœ¨"),setTimeout(B,2e3)}async function Ae(){console.log("[Renderer] Initializing...");const e=await window.electronAPI.loadConfig();ce(),we(),fe(),De(),ie(e),window.electronAPI.onActivateChat(()=>{ve()}),console.log("[Renderer] Ready!")}window.addEventListener("DOMContentLoaded",()=>{Ae()});
