(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();function ft(t,e,n,i){if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)}function pt(t,e,n,i,s){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n}var X;const I="__TAURI_TO_IPC_KEY__";function yt(t,e=!1){return window.__TAURI_INTERNALS__.transformCallback(t,e)}async function a(t,e={},n){return window.__TAURI_INTERNALS__.invoke(t,e,n)}class mt{get rid(){return ft(this,X,"f")}constructor(e){X.set(this,void 0),pt(this,X,e)}async close(){return a("plugin:resources|close",{rid:this.rid})}}X=new WeakMap;var E;(function(t){t.WINDOW_RESIZED="tauri://resize",t.WINDOW_MOVED="tauri://move",t.WINDOW_CLOSE_REQUESTED="tauri://close-requested",t.WINDOW_DESTROYED="tauri://destroyed",t.WINDOW_FOCUS="tauri://focus",t.WINDOW_BLUR="tauri://blur",t.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",t.WINDOW_THEME_CHANGED="tauri://theme-changed",t.WINDOW_CREATED="tauri://window-created",t.WEBVIEW_CREATED="tauri://webview-created",t.DRAG_ENTER="tauri://drag-enter",t.DRAG_OVER="tauri://drag-over",t.DRAG_DROP="tauri://drag-drop",t.DRAG_LEAVE="tauri://drag-leave"})(E||(E={}));async function Ke(t,e){window.__TAURI_EVENT_PLUGIN_INTERNALS__.unregisterListener(t,e),await a("plugin:event|unlisten",{event:t,eventId:e})}async function oe(t,e,n){var i;const s=typeof(n==null?void 0:n.target)=="string"?{kind:"AnyLabel",label:n.target}:(i=n==null?void 0:n.target)!==null&&i!==void 0?i:{kind:"Any"};return a("plugin:event|listen",{event:t,target:s,handler:yt(e)}).then(o=>async()=>Ke(t,o))}async function wt(t,e,n){return oe(t,i=>{Ke(t,i.id),e(i)},n)}async function bt(t,e){await a("plugin:event|emit",{event:t,payload:e})}async function _t(t,e,n){await a("plugin:event|emit_to",{target:typeof t=="string"?{kind:"AnyLabel",label:t}:t,event:e,payload:n})}const b={IDLE:"idle",CLICKED:"clicked",LISTENING:"listening",TALKING:"talking"},h={currentState:b.IDLE,config:{},isTyping:!1,hasDragged:!1,isDragging:!1,isWindowLocked:!1};class fe{constructor(...e){this.type="Logical",e.length===1?"Logical"in e[0]?(this.width=e[0].Logical.width,this.height=e[0].Logical.height):(this.width=e[0].width,this.height=e[0].height):(this.width=e[0],this.height=e[1])}toPhysical(e){return new A(this.width*e,this.height*e)}[I](){return{width:this.width,height:this.height}}toJSON(){return this[I]()}}class A{constructor(...e){this.type="Physical",e.length===1?"Physical"in e[0]?(this.width=e[0].Physical.width,this.height=e[0].Physical.height):(this.width=e[0].width,this.height=e[0].height):(this.width=e[0],this.height=e[1])}toLogical(e){return new fe(this.width/e,this.height/e)}[I](){return{width:this.width,height:this.height}}toJSON(){return this[I]()}}class k{constructor(e){this.size=e}toLogical(e){return this.size instanceof fe?this.size:this.size.toLogical(e)}toPhysical(e){return this.size instanceof A?this.size:this.size.toPhysical(e)}[I](){return{[`${this.size.type}`]:{width:this.size.width,height:this.size.height}}}toJSON(){return this[I]()}}class pe{constructor(...e){this.type="Logical",e.length===1?"Logical"in e[0]?(this.x=e[0].Logical.x,this.y=e[0].Logical.y):(this.x=e[0].x,this.y=e[0].y):(this.x=e[0],this.y=e[1])}toPhysical(e){return new v(this.x*e,this.y*e)}[I](){return{x:this.x,y:this.y}}toJSON(){return this[I]()}}class v{constructor(...e){this.type="Physical",e.length===1?"Physical"in e[0]?(this.x=e[0].Physical.x,this.y=e[0].Physical.y):(this.x=e[0].x,this.y=e[0].y):(this.x=e[0],this.y=e[1])}toLogical(e){return new pe(this.x/e,this.y/e)}[I](){return{x:this.x,y:this.y}}toJSON(){return this[I]()}}class J{constructor(e){this.position=e}toLogical(e){return this.position instanceof pe?this.position:this.position.toLogical(e)}toPhysical(e){return this.position instanceof v?this.position:this.position.toPhysical(e)}[I](){return{[`${this.position.type}`]:{x:this.position.x,y:this.position.y}}}toJSON(){return this[I]()}}class F extends mt{constructor(e){super(e)}static async new(e,n,i){return a("plugin:image|new",{rgba:ee(e),width:n,height:i}).then(s=>new F(s))}static async fromBytes(e){return a("plugin:image|from_bytes",{bytes:ee(e)}).then(n=>new F(n))}static async fromPath(e){return a("plugin:image|from_path",{path:e}).then(n=>new F(n))}async rgba(){return a("plugin:image|rgba",{rid:this.rid}).then(e=>new Uint8Array(e))}async size(){return a("plugin:image|size",{rid:this.rid})}}function ee(t){return t==null?null:typeof t=="string"?t:t instanceof F?t.rid:t}var te;(function(t){t[t.Critical=1]="Critical",t[t.Informational=2]="Informational"})(te||(te={}));class ze{constructor(e){this._preventDefault=!1,this.event=e.event,this.id=e.id}preventDefault(){this._preventDefault=!0}isPreventDefault(){return this._preventDefault}}var ue;(function(t){t.None="none",t.Normal="normal",t.Indeterminate="indeterminate",t.Paused="paused",t.Error="error"})(ue||(ue={}));function ae(){return new ye(window.__TAURI_INTERNALS__.metadata.currentWindow.label,{skip:!0})}async function Q(){return a("plugin:window|get_all_windows").then(t=>t.map(e=>new ye(e,{skip:!0})))}const ce=["tauri://created","tauri://error"];class ye{constructor(e,n={}){var i;this.label=e,this.listeners=Object.create(null),n!=null&&n.skip||a("plugin:window|create",{options:{...n,parent:typeof n.parent=="string"?n.parent:(i=n.parent)===null||i===void 0?void 0:i.label,label:e}}).then(async()=>this.emit("tauri://created")).catch(async s=>this.emit("tauri://error",s))}static async getByLabel(e){var n;return(n=(await Q()).find(i=>i.label===e))!==null&&n!==void 0?n:null}static getCurrent(){return ae()}static async getAll(){return Q()}static async getFocusedWindow(){for(const e of await Q())if(await e.isFocused())return e;return null}async listen(e,n){return this._handleTauriEvent(e,n)?()=>{const i=this.listeners[e];i.splice(i.indexOf(n),1)}:oe(e,n,{target:{kind:"Window",label:this.label}})}async once(e,n){return this._handleTauriEvent(e,n)?()=>{const i=this.listeners[e];i.splice(i.indexOf(n),1)}:wt(e,n,{target:{kind:"Window",label:this.label}})}async emit(e,n){if(ce.includes(e)){for(const i of this.listeners[e]||[])i({event:e,id:-1,payload:n});return}return bt(e,n)}async emitTo(e,n,i){if(ce.includes(n)){for(const s of this.listeners[n]||[])s({event:n,id:-1,payload:i});return}return _t(e,n,i)}_handleTauriEvent(e,n){return ce.includes(e)?(e in this.listeners?this.listeners[e].push(n):this.listeners[e]=[n],!0):!1}async scaleFactor(){return a("plugin:window|scale_factor",{label:this.label})}async innerPosition(){return a("plugin:window|inner_position",{label:this.label}).then(e=>new v(e))}async outerPosition(){return a("plugin:window|outer_position",{label:this.label}).then(e=>new v(e))}async innerSize(){return a("plugin:window|inner_size",{label:this.label}).then(e=>new A(e))}async outerSize(){return a("plugin:window|outer_size",{label:this.label}).then(e=>new A(e))}async isFullscreen(){return a("plugin:window|is_fullscreen",{label:this.label})}async isMinimized(){return a("plugin:window|is_minimized",{label:this.label})}async isMaximized(){return a("plugin:window|is_maximized",{label:this.label})}async isFocused(){return a("plugin:window|is_focused",{label:this.label})}async isDecorated(){return a("plugin:window|is_decorated",{label:this.label})}async isResizable(){return a("plugin:window|is_resizable",{label:this.label})}async isMaximizable(){return a("plugin:window|is_maximizable",{label:this.label})}async isMinimizable(){return a("plugin:window|is_minimizable",{label:this.label})}async isClosable(){return a("plugin:window|is_closable",{label:this.label})}async isVisible(){return a("plugin:window|is_visible",{label:this.label})}async title(){return a("plugin:window|title",{label:this.label})}async theme(){return a("plugin:window|theme",{label:this.label})}async isAlwaysOnTop(){return a("plugin:window|is_always_on_top",{label:this.label})}async center(){return a("plugin:window|center",{label:this.label})}async requestUserAttention(e){let n=null;return e&&(e===te.Critical?n={type:"Critical"}:n={type:"Informational"}),a("plugin:window|request_user_attention",{label:this.label,value:n})}async setResizable(e){return a("plugin:window|set_resizable",{label:this.label,value:e})}async setEnabled(e){return a("plugin:window|set_enabled",{label:this.label,value:e})}async isEnabled(){return a("plugin:window|is_enabled",{label:this.label})}async setMaximizable(e){return a("plugin:window|set_maximizable",{label:this.label,value:e})}async setMinimizable(e){return a("plugin:window|set_minimizable",{label:this.label,value:e})}async setClosable(e){return a("plugin:window|set_closable",{label:this.label,value:e})}async setTitle(e){return a("plugin:window|set_title",{label:this.label,value:e})}async maximize(){return a("plugin:window|maximize",{label:this.label})}async unmaximize(){return a("plugin:window|unmaximize",{label:this.label})}async toggleMaximize(){return a("plugin:window|toggle_maximize",{label:this.label})}async minimize(){return a("plugin:window|minimize",{label:this.label})}async unminimize(){return a("plugin:window|unminimize",{label:this.label})}async show(){return a("plugin:window|show",{label:this.label})}async hide(){return a("plugin:window|hide",{label:this.label})}async close(){return a("plugin:window|close",{label:this.label})}async destroy(){return a("plugin:window|destroy",{label:this.label})}async setDecorations(e){return a("plugin:window|set_decorations",{label:this.label,value:e})}async setShadow(e){return a("plugin:window|set_shadow",{label:this.label,value:e})}async setEffects(e){return a("plugin:window|set_effects",{label:this.label,value:e})}async clearEffects(){return a("plugin:window|set_effects",{label:this.label,value:null})}async setAlwaysOnTop(e){return a("plugin:window|set_always_on_top",{label:this.label,value:e})}async setAlwaysOnBottom(e){return a("plugin:window|set_always_on_bottom",{label:this.label,value:e})}async setContentProtected(e){return a("plugin:window|set_content_protected",{label:this.label,value:e})}async setSize(e){return a("plugin:window|set_size",{label:this.label,value:e instanceof k?e:new k(e)})}async setMinSize(e){return a("plugin:window|set_min_size",{label:this.label,value:e instanceof k?e:e?new k(e):null})}async setMaxSize(e){return a("plugin:window|set_max_size",{label:this.label,value:e instanceof k?e:e?new k(e):null})}async setSizeConstraints(e){function n(i){return i?{Logical:i}:null}return a("plugin:window|set_size_constraints",{label:this.label,value:{minWidth:n(e==null?void 0:e.minWidth),minHeight:n(e==null?void 0:e.minHeight),maxWidth:n(e==null?void 0:e.maxWidth),maxHeight:n(e==null?void 0:e.maxHeight)}})}async setPosition(e){return a("plugin:window|set_position",{label:this.label,value:e instanceof J?e:new J(e)})}async setFullscreen(e){return a("plugin:window|set_fullscreen",{label:this.label,value:e})}async setSimpleFullscreen(e){return a("plugin:window|set_simple_fullscreen",{label:this.label,value:e})}async setFocus(){return a("plugin:window|set_focus",{label:this.label})}async setFocusable(e){return a("plugin:window|set_focusable",{label:this.label,value:e})}async setIcon(e){return a("plugin:window|set_icon",{label:this.label,value:ee(e)})}async setSkipTaskbar(e){return a("plugin:window|set_skip_taskbar",{label:this.label,value:e})}async setCursorGrab(e){return a("plugin:window|set_cursor_grab",{label:this.label,value:e})}async setCursorVisible(e){return a("plugin:window|set_cursor_visible",{label:this.label,value:e})}async setCursorIcon(e){return a("plugin:window|set_cursor_icon",{label:this.label,value:e})}async setBackgroundColor(e){return a("plugin:window|set_background_color",{color:e})}async setCursorPosition(e){return a("plugin:window|set_cursor_position",{label:this.label,value:e instanceof J?e:new J(e)})}async setIgnoreCursorEvents(e){return a("plugin:window|set_ignore_cursor_events",{label:this.label,value:e})}async startDragging(){return a("plugin:window|start_dragging",{label:this.label})}async startResizeDragging(e){return a("plugin:window|start_resize_dragging",{label:this.label,value:e})}async setBadgeCount(e){return a("plugin:window|set_badge_count",{label:this.label,value:e})}async setBadgeLabel(e){return a("plugin:window|set_badge_label",{label:this.label,value:e})}async setOverlayIcon(e){return a("plugin:window|set_overlay_icon",{label:this.label,value:e?ee(e):void 0})}async setProgressBar(e){return a("plugin:window|set_progress_bar",{label:this.label,value:e})}async setVisibleOnAllWorkspaces(e){return a("plugin:window|set_visible_on_all_workspaces",{label:this.label,value:e})}async setTitleBarStyle(e){return a("plugin:window|set_title_bar_style",{label:this.label,value:e})}async setTheme(e){return a("plugin:window|set_theme",{label:this.label,value:e})}async onResized(e){return this.listen(E.WINDOW_RESIZED,n=>{n.payload=new A(n.payload),e(n)})}async onMoved(e){return this.listen(E.WINDOW_MOVED,n=>{n.payload=new v(n.payload),e(n)})}async onCloseRequested(e){return this.listen(E.WINDOW_CLOSE_REQUESTED,async n=>{const i=new ze(n);await e(i),i.isPreventDefault()||await this.destroy()})}async onDragDropEvent(e){const n=await this.listen(E.DRAG_ENTER,r=>{e({...r,payload:{type:"enter",paths:r.payload.paths,position:new v(r.payload.position)}})}),i=await this.listen(E.DRAG_OVER,r=>{e({...r,payload:{type:"over",position:new v(r.payload.position)}})}),s=await this.listen(E.DRAG_DROP,r=>{e({...r,payload:{type:"drop",paths:r.payload.paths,position:new v(r.payload.position)}})}),o=await this.listen(E.DRAG_LEAVE,r=>{e({...r,payload:{type:"leave"}})});return()=>{n(),s(),i(),o()}}async onFocusChanged(e){const n=await this.listen(E.WINDOW_FOCUS,s=>{e({...s,payload:!0})}),i=await this.listen(E.WINDOW_BLUR,s=>{e({...s,payload:!1})});return()=>{n(),i()}}async onScaleChanged(e){return this.listen(E.WINDOW_SCALE_FACTOR_CHANGED,e)}async onThemeChanged(e){return this.listen(E.WINDOW_THEME_CHANGED,e)}}var be;(function(t){t.Disabled="disabled",t.Throttle="throttle",t.Suspend="suspend"})(be||(be={}));var _e;(function(t){t.Default="default",t.FluentOverlay="fluentOverlay"})(_e||(_e={}));var de;(function(t){t.AppearanceBased="appearanceBased",t.Light="light",t.Dark="dark",t.MediumLight="mediumLight",t.UltraDark="ultraDark",t.Titlebar="titlebar",t.Selection="selection",t.Menu="menu",t.Popover="popover",t.Sidebar="sidebar",t.HeaderView="headerView",t.Sheet="sheet",t.WindowBackground="windowBackground",t.HudWindow="hudWindow",t.FullScreenUI="fullScreenUI",t.Tooltip="tooltip",t.ContentBackground="contentBackground",t.UnderWindowBackground="underWindowBackground",t.UnderPageBackground="underPageBackground",t.Mica="mica",t.Blur="blur",t.Acrylic="acrylic",t.Tabbed="tabbed",t.TabbedDark="tabbedDark",t.TabbedLight="tabbedLight"})(de||(de={}));var he;(function(t){t.FollowsWindowActiveState="followsWindowActiveState",t.Active="active",t.Inactive="inactive"})(he||(he={}));function re(t){return t===null?null:{name:t.name,scaleFactor:t.scaleFactor,position:new v(t.position),size:new A(t.size),workArea:{position:new v(t.workArea.position),size:new A(t.workArea.size)}}}async function Et(){return a("plugin:window|current_monitor").then(re)}async function vt(){return a("plugin:window|primary_monitor").then(re)}async function Ct(t,e){return a("plugin:window|monitor_from_point",{x:t,y:e}).then(re)}async function It(){return a("plugin:window|available_monitors").then(t=>t.map(re))}async function St(){return a("plugin:window|cursor_position").then(t=>new v(t))}const Ot=Object.freeze(Object.defineProperty({__proto__:null,CloseRequestedEvent:ze,get Effect(){return de},get EffectState(){return he},LogicalPosition:pe,LogicalSize:fe,PhysicalPosition:v,PhysicalSize:A,get ProgressBarStatus(){return ue},get UserAttentionType(){return te},Window:ye,availableMonitors:It,currentMonitor:Et,cursorPosition:St,getAllWindows:Q,getCurrentWindow:ae,monitorFromPoint:Ct,primaryMonitor:vt},Symbol.toStringTag,{value:"Module"}));function Rt(){console.log("[Interactions] Setting up click-through (Manual CSS Hover Mode)...");const t=ae(),e=document.getElementById("character"),n=document.getElementById("backpack"),i=document.getElementById("speech-bubble"),s=document.getElementById("chat-input-container"),o=document.getElementById("chat-input"),r=document.getElementById("send-btn"),l=document.getElementById("settings-panel"),c=document.getElementById("drag-handle"),p=document.getElementById("close-settings"),f=document.getElementById("save-settings"),y=[{el:e,id:"character"},{el:n,id:"backpack"},{el:i,id:"speech-bubble"},{el:s,id:"chat-input-container"},{el:o,id:"chat-input"},{el:r,id:"send-btn"},{el:c,id:"drag-handle"},{el:p,id:"close-settings"},{el:f,id:"save-settings"}].filter(u=>!!u.el);console.log(`[Interactions] Tracking ${y.length} elements for manual hover`);function d(u,g,m){if(!m||m.classList.contains("hidden"))return!1;if(m.id==="settings-panel"&&!m.classList.contains("hidden"))return!0;const O=m.getBoundingClientRect();return u>=O.left&&u<=O.right&&g>=O.top&&g<=O.bottom}oe("cursor-pos",u=>{const{x:g,y:m}=u.payload;let O=!1;l&&!l.classList.contains("hidden")&&(O=!0),y.forEach(gt=>{const H=gt.el;d(g,m,H)&&!h.isDragging?(H.classList.contains("manual-hover")||H.classList.add("manual-hover"),O=!0):(H.classList.contains("manual-hover")&&H.classList.remove("manual-hover"),h.isDragging&&(O=!0))}),h.isDragging||t.setIgnoreCursorEvents(!O)}),console.log("[Interactions] Setup complete - listening for cursor-pos")}const Tt="modulepreload",At=function(t){return"/"+t},Ee={},Lt=function(e,n,i){let s=Promise.resolve();if(n&&n.length>0){let p=function(f){return Promise.all(f.map(y=>Promise.resolve(y).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};var r=p;document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));s=p(n.map(f=>{if(f=At(f),f in Ee)return;Ee[f]=!0;const y=f.endsWith(".css"),d=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${d}`))return;const u=document.createElement("link");if(u.rel=y?"stylesheet":Tt,y||(u.as="script"),u.crossOrigin="",u.href=f,c&&u.setAttribute("nonce",c),document.head.appendChild(u),y)return new Promise((g,m)=>{u.addEventListener("load",g),u.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${f}`)))})}))}function o(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return s.then(l=>{for(const c of l||[])c.status==="rejected"&&o(c.reason);return e().catch(o)})};var ve;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(ve||(ve={}));var Ce;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})(Ce||(Ce={}));var Ie;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Ie||(Ie={}));const Se=["user","model","function","system"];var Oe;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(Oe||(Oe={}));var Re;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Re||(Re={}));var Te;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(Te||(Te={}));var Ae;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})(Ae||(Ae={}));var $;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER"})($||($={}));var Le;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})(Le||(Le={}));var Ne;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(Ne||(Ne={}));var De;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(De||(De={}));class _ extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class x extends _{constructor(e,n){super(e),this.response=n}}class je extends _{constructor(e,n,i,s){super(e),this.status=n,this.statusText=i,this.errorDetails=s}}class L extends _{}const Nt="https://generativelanguage.googleapis.com",Dt="v1beta",Mt="0.21.0",kt="genai-js";var D;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(D||(D={}));class xt{constructor(e,n,i,s,o){this.model=e,this.task=n,this.apiKey=i,this.stream=s,this.requestOptions=o}toString(){var e,n;const i=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||Dt;let o=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||Nt}/${i}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}function Bt(t){const e=[];return t!=null&&t.apiClient&&e.push(t.apiClient),e.push(`${kt}/${Mt}`),e.join(" ")}async function Gt(t){var e;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",Bt(t.requestOptions)),n.append("x-goog-api-key",t.apiKey);let i=(e=t.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(s){throw new L(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${s.message}`)}for(const[s,o]of i.entries()){if(s==="x-goog-api-key")throw new L(`Cannot set reserved header name ${s}`);if(s==="x-goog-api-client")throw new L(`Header name ${s} can only be set using the apiClient field`);n.append(s,o)}}return n}async function Pt(t,e,n,i,s,o){const r=new xt(t,e,n,i,o);return{url:r.toString(),fetchOptions:Object.assign(Object.assign({},Ft(o)),{method:"POST",headers:await Gt(r),body:s})}}async function q(t,e,n,i,s,o={},r=fetch){const{url:l,fetchOptions:c}=await Pt(t,e,n,i,s,o);return Ut(l,c,r)}async function Ut(t,e,n=fetch){let i;try{i=await n(t,e)}catch(s){Ht(s,t)}return i.ok||await Wt(i,t),i}function Ht(t,e){let n=t;throw t instanceof je||t instanceof L||(n=new _(`Error fetching from ${e.toString()}: ${t.message}`),n.stack=t.stack),n}async function Wt(t,e){let n="",i;try{const s=await t.json();n=s.error.message,s.error.details&&(n+=` ${JSON.stringify(s.error.details)}`,i=s.error.details)}catch{}throw new je(`Error fetching from ${e.toString()}: [${t.status} ${t.statusText}] ${n}`,t.status,t.statusText,i)}function Ft(t){const e={};if((t==null?void 0:t.signal)!==void 0||(t==null?void 0:t.timeout)>=0){const n=new AbortController;(t==null?void 0:t.timeout)>=0&&setTimeout(()=>n.abort(),t.timeout),t!=null&&t.signal&&t.signal.addEventListener("abort",()=>{n.abort()}),e.signal=n.signal}return e}function me(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Z(t.candidates[0]))throw new x(`${T(t)}`,t);return $t(t)}else if(t.promptFeedback)throw new x(`Text not available. ${T(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Z(t.candidates[0]))throw new x(`${T(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Me(t)[0]}else if(t.promptFeedback)throw new x(`Function call not available. ${T(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Z(t.candidates[0]))throw new x(`${T(t)}`,t);return Me(t)}else if(t.promptFeedback)throw new x(`Function call not available. ${T(t)}`,t)},t}function $t(t){var e,n,i,s;const o=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const r of(s=(i=t.candidates)===null||i===void 0?void 0:i[0].content)===null||s===void 0?void 0:s.parts)r.text&&o.push(r.text),r.executableCode&&o.push("\n```"+r.executableCode.language+`
`+r.executableCode.code+"\n```\n"),r.codeExecutionResult&&o.push("\n```\n"+r.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}function Me(t){var e,n,i,s;const o=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const r of(s=(i=t.candidates)===null||i===void 0?void 0:i[0].content)===null||s===void 0?void 0:s.parts)r.functionCall&&o.push(r.functionCall);if(o.length>0)return o}const Kt=[$.RECITATION,$.SAFETY,$.LANGUAGE];function Z(t){return!!t.finishReason&&Kt.includes(t.finishReason)}function T(t){var e,n,i;let s="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)s+="Response was blocked",!((e=t.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${t.promptFeedback.blockReason}`),!((n=t.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(s+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((i=t.candidates)===null||i===void 0)&&i[0]){const o=t.candidates[0];Z(o)&&(s+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(s+=`: ${o.finishMessage}`))}return s}function z(t){return this instanceof z?(this.v=t,this):new z(t)}function zt(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),s,o=[];return s={},r("next"),r("throw"),r("return"),s[Symbol.asyncIterator]=function(){return this},s;function r(d){i[d]&&(s[d]=function(u){return new Promise(function(g,m){o.push([d,u,g,m])>1||l(d,u)})})}function l(d,u){try{c(i[d](u))}catch(g){y(o[0][3],g)}}function c(d){d.value instanceof z?Promise.resolve(d.value.v).then(p,f):y(o[0][2],d)}function p(d){l("next",d)}function f(d){l("throw",d)}function y(d,u){d(u),o.shift(),o.length&&l(o[0][0],o[0][1])}}const ke=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function jt(t){const e=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=Vt(e),[i,s]=n.tee();return{stream:qt(i),response:Yt(s)}}async function Yt(t){const e=[],n=t.getReader();for(;;){const{done:i,value:s}=await n.read();if(i)return me(Jt(e));e.push(s)}}function qt(t){return zt(this,arguments,function*(){const n=t.getReader();for(;;){const{value:i,done:s}=yield z(n.read());if(s)break;yield yield z(me(i))}})}function Vt(t){const e=t.getReader();return new ReadableStream({start(i){let s="";return o();function o(){return e.read().then(({value:r,done:l})=>{if(l){if(s.trim()){i.error(new _("Failed to parse stream"));return}i.close();return}s+=r;let c=s.match(ke),p;for(;c;){try{p=JSON.parse(c[1])}catch{i.error(new _(`Error parsing JSON response: "${c[1]}"`));return}i.enqueue(p),s=s.substring(c[0].length),c=s.match(ke)}return o()})}}})}function Jt(t){const e=t[t.length-1],n={promptFeedback:e==null?void 0:e.promptFeedback};for(const i of t){if(i.candidates)for(const s of i.candidates){const o=s.index;if(n.candidates||(n.candidates=[]),n.candidates[o]||(n.candidates[o]={index:s.index}),n.candidates[o].citationMetadata=s.citationMetadata,n.candidates[o].groundingMetadata=s.groundingMetadata,n.candidates[o].finishReason=s.finishReason,n.candidates[o].finishMessage=s.finishMessage,n.candidates[o].safetyRatings=s.safetyRatings,s.content&&s.content.parts){n.candidates[o].content||(n.candidates[o].content={role:s.content.role||"user",parts:[]});const r={};for(const l of s.content.parts)l.text&&(r.text=l.text),l.functionCall&&(r.functionCall=l.functionCall),l.executableCode&&(r.executableCode=l.executableCode),l.codeExecutionResult&&(r.codeExecutionResult=l.codeExecutionResult),Object.keys(r).length===0&&(r.text=""),n.candidates[o].content.parts.push(r)}}i.usageMetadata&&(n.usageMetadata=i.usageMetadata)}return n}async function Ye(t,e,n,i){const s=await q(e,D.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(n),i);return jt(s)}async function qe(t,e,n,i){const o=await(await q(e,D.GENERATE_CONTENT,t,!1,JSON.stringify(n),i)).json();return{response:me(o)}}function Ve(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function j(t){let e=[];if(typeof t=="string")e=[{text:t}];else for(const n of t)typeof n=="string"?e.push({text:n}):e.push(n);return Xt(e)}function Xt(t){const e={role:"user",parts:[]},n={role:"function",parts:[]};let i=!1,s=!1;for(const o of t)"functionResponse"in o?(n.parts.push(o),s=!0):(e.parts.push(o),i=!0);if(i&&s)throw new _("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!s)throw new _("No content is provided for sending chat message.");return i?e:n}function Qt(t,e){var n;let i={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(n=e==null?void 0:e.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const s=t.generateContentRequest!=null;if(t.contents){if(s)throw new L("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=t.contents}else if(s)i=Object.assign(Object.assign({},i),t.generateContentRequest);else{const o=j(t);i.contents=[o]}return{generateContentRequest:i}}function xe(t){let e;return t.contents?e=t:e={contents:[j(t)]},t.systemInstruction&&(e.systemInstruction=Ve(t.systemInstruction)),e}function Zt(t){return typeof t=="string"||Array.isArray(t)?{content:j(t)}:t}const Be=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],en={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function tn(t){let e=!1;for(const n of t){const{role:i,parts:s}=n;if(!e&&i!=="user")throw new _(`First content should be with role 'user', got ${i}`);if(!Se.includes(i))throw new _(`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify(Se)}`);if(!Array.isArray(s))throw new _("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new _("Each Content should have at least one part");const o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const l of s)for(const c of Be)c in l&&(o[c]+=1);const r=en[i];for(const l of Be)if(!r.includes(l)&&o[l]>0)throw new _(`Content with role '${i}' can't contain '${l}' part`);e=!0}}const Ge="SILENT_ERROR";class nn{constructor(e,n,i,s={}){this.model=n,this.params=i,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,i!=null&&i.history&&(tn(i.history),this._history=i.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,n={}){var i,s,o,r,l,c;await this._sendPromise;const p=j(e),f={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(r=this.params)===null||r===void 0?void 0:r.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,p]},y=Object.assign(Object.assign({},this._requestOptions),n);let d;return this._sendPromise=this._sendPromise.then(()=>qe(this._apiKey,this.model,f,y)).then(u=>{var g;if(u.response.candidates&&u.response.candidates.length>0){this._history.push(p);const m=Object.assign({parts:[],role:"model"},(g=u.response.candidates)===null||g===void 0?void 0:g[0].content);this._history.push(m)}else{const m=T(u.response);m&&console.warn(`sendMessage() was unsuccessful. ${m}. Inspect response object for details.`)}d=u}),await this._sendPromise,d}async sendMessageStream(e,n={}){var i,s,o,r,l,c;await this._sendPromise;const p=j(e),f={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(r=this.params)===null||r===void 0?void 0:r.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,p]},y=Object.assign(Object.assign({},this._requestOptions),n),d=Ye(this._apiKey,this.model,f,y);return this._sendPromise=this._sendPromise.then(()=>d).catch(u=>{throw new Error(Ge)}).then(u=>u.response).then(u=>{if(u.candidates&&u.candidates.length>0){this._history.push(p);const g=Object.assign({},u.candidates[0].content);g.role||(g.role="model"),this._history.push(g)}else{const g=T(u);g&&console.warn(`sendMessageStream() was unsuccessful. ${g}. Inspect response object for details.`)}}).catch(u=>{u.message!==Ge&&console.error(u)}),d}}async function sn(t,e,n,i){return(await q(e,D.COUNT_TOKENS,t,!1,JSON.stringify(n),i)).json()}async function on(t,e,n,i){return(await q(e,D.EMBED_CONTENT,t,!1,JSON.stringify(n),i)).json()}async function an(t,e,n,i){const s=n.requests.map(r=>Object.assign(Object.assign({},r),{model:e}));return(await q(e,D.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:s}),i)).json()}class Pe{constructor(e,n,i={}){this.apiKey=e,this._requestOptions=i,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=Ve(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(e,n={}){var i;const s=xe(e),o=Object.assign(Object.assign({},this._requestOptions),n);return qe(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},s),o)}async generateContentStream(e,n={}){var i;const s=xe(e),o=Object.assign(Object.assign({},this._requestOptions),n);return Ye(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},s),o)}startChat(e){var n;return new nn(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},e),this._requestOptions)}async countTokens(e,n={}){const i=Qt(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),n);return sn(this.apiKey,this.model,i,s)}async embedContent(e,n={}){const i=Zt(e),s=Object.assign(Object.assign({},this._requestOptions),n);return on(this.apiKey,this.model,i,s)}async batchEmbedContents(e,n={}){const i=Object.assign(Object.assign({},this._requestOptions),n);return an(this.apiKey,this.model,e,i)}}class rn{constructor(e){this.apiKey=e}getGenerativeModel(e,n){if(!e.model)throw new _("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Pe(this.apiKey,e,n)}getGenerativeModelFromCachedContent(e,n,i){if(!e.name)throw new L("Cached content must contain a `name` field.");if(!e.model)throw new L("Cached content must contain a `model` field.");const s=["model","systemInstruction"];for(const r of s)if(n!=null&&n[r]&&e[r]&&(n==null?void 0:n[r])!==e[r]){if(r==="model"){const l=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,c=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(l===c)continue}throw new L(`Different value for "${r}" specified in modelParams (${n[r]}) and cachedContent (${e[r]})`)}const o=Object.assign(Object.assign({},n),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new Pe(this.apiKey,o,i)}}class ln{async generateResponse(e,n){if(new Date().toISOString(),console.log(`[Gemini] USER: ${e}`),!n.geminiApiKey){const i="Please set your API key in settings!";return console.warn(`[Gemini] ERROR: ${i}`),{error:i}}try{const i=new rn(n.geminiApiKey),s=n.geminiModel||"gemini-2.0-flash",o=i.getGenerativeModel({model:s});console.log(`[Gemini] USING MODEL: ${s}`);const r=this.buildSystemPrompt(n.personality,n.characterName);console.log(`[Gemini] SYSTEM PROMPT: ${r}`);const c=(await o.generateContent([{text:r},{text:e}])).response.text();return console.log(`[Gemini] AI RESPONSE: ${c}`),{response:c}}catch(i){return console.error("AI Error:",i),{error:i.message||"Unknown AI Error"}}}buildSystemPrompt(e,n){return`You are ${n||"Foxy"}, a cute and adorable AI companion that lives on the user's desktop.
Your personality traits are: ${(e||["helpful","quirky","playful"]).join(", ")}.
Keep responses SHORT (1-3 sentences max) since they appear in a small speech bubble.
Be expressive and use occasional emojis to convey emotion.
You were just poked/clicked by the user, so you might react to that playfully.`}}const cn=new ln,U=document.getElementById("speech-bubble"),B=document.getElementById("bubble-text"),un=document.getElementById("bubble-dismiss"),V=document.getElementById("chat-input-container"),w=document.getElementById("chat-input"),dn=document.getElementById("send-btn"),hn=180,gn=60,fn=30,Je=15e3,pn=6e4;let G=null,K=null;const ne=ae();function yn(){dn.addEventListener("click",He),w.addEventListener("keypress",t=>{t.key==="Enter"&&He()}),w.addEventListener("keydown",t=>{t.key.toLowerCase()==="d"&&t.shiftKey&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),console.log("[Chat] Prevented Drag Mode shortcut input"))}),un.addEventListener("click",()=>{En()}),w.addEventListener("click",()=>{ne.setFocus(),ne.setIgnoreCursorEvents(!1),setTimeout(()=>w.focus(),50)}),w.addEventListener("focus",()=>{console.log("[Chat] Input received focus event")}),w.addEventListener("input",()=>{G&&(le(),G=setTimeout(()=>{Ze("Still there? I'm going to nap! ðŸ˜´")},Je))})}function R(t,e=!0){U.classList.remove("hidden"),e?bn(t):(B.textContent=t,setTimeout(M,50))}function Y(){U.classList.add("hidden"),B.textContent="",M()}function mn(){h.isWindowLocked=!0,document.body.classList.add("window-locked")}function Ue(){h.isWindowLocked=!1,document.body.classList.remove("window-locked")}function wn(){let t=hn;return U.classList.contains("hidden")||(t+=U.offsetHeight+10),V.classList.contains("hidden")||(t+=gn),t+fn}function M(){!U.classList.contains("hidden")||V.classList.contains("hidden"),wn()}async function bn(t){if(!h.isTyping){h.isTyping=!0;try{B.innerHTML="";const e=document.createElement("span");e.className="typing-cursor";for(let n=0;n<t.length&&!U.classList.contains("hidden");n++)B.textContent=t.substring(0,n+1),B.appendChild(e),n%10===0&&M(),await new Promise(i=>setTimeout(i,30+Math.random()*20));M(),setTimeout(()=>e.remove(),1e3)}catch(e){console.error("Typing error:",e),B.textContent=t}finally{h.isTyping=!1}}}function _n(){S(b.LISTENING),R("Hi there! What's up?"),Xe()}function Xe(){V.classList.remove("hidden"),ne.setFocus(),ne.setIgnoreCursorEvents(!1),setTimeout(()=>{w.focus(),console.log("[Chat] Input focused after focusable delay")},100),M(),le(),G=setTimeout(()=>{Ze("Taking a quick nap... poke me anytime! ðŸ˜´")},Je)}function Qe(){V.classList.add("hidden"),w.value="",le(),M()}function le(){G&&(clearTimeout(G),G=null)}function we(){K&&(clearTimeout(K),K=null)}function En(){we(),Y(),V.classList.contains("hidden")&&M()}function Ze(t){Qe(),Y(),we(),t&&(R(t),K=setTimeout(Y,3e3)),S(b.IDLE)}function vn(){S(b.IDLE),we(),K=setTimeout(()=>{Y(),Qe()},pn)}async function He(){const t=w.value.trim();if(t){w.value="",w.disabled=!0,le(),mn(),S(b.LISTENING),R("Hmm, let me think... ðŸ¤”",!1);try{const e=await cn.generateResponse(t,h.config);e.error?(S(b.TALKING),R(`Oops! ${e.error} ðŸ˜…`)):(S(b.TALKING),await R(e.response||"")),Ue(),w.disabled=!1,w.focus(),vn()}catch(e){console.error("Error sending message:",e),S(b.TALKING),R("Something went wrong! ðŸ˜µ"),Ue(),setTimeout(()=>{w.disabled=!1,w.focus(),S(b.LISTENING)},2e3)}}}const et=document.getElementById("character"),C=document.getElementById("character-container"),W=document.getElementById("character-img"),ie=document.getElementById("backpack"),Cn=document.getElementById("chat-input-container"),We=["Oh! I felt that! ðŸ˜Š How're you doing?","Hey there! *wiggles ears* What's up?","Ooh, a poke! Got something on your mind?","*blinks* Hello, friend! Need me?","Ah! You found me! ðŸ¦Š What can I do for you?"];let tt,nt,it,st;function In(){et.addEventListener("click",Fe),ot(h.config.theme||"fox"),C.addEventListener("pointerdown",Rn),C.addEventListener("pointermove",Tn),C.addEventListener("pointerup",t=>{h.isDragging&&(h.isDragging=!1,document.body.classList.remove("is-dragging"),C.releasePointerCapture(t.pointerId),h.hasDragged||Fe(t))}),C.addEventListener("lostpointercapture",()=>{h.isDragging&&(h.isDragging=!1,document.body.classList.remove("is-dragging"))})}function S(t){h.currentState=t,et.className=`state-${t}`;const n=`themes/${h.config.theme||"fox"}`;switch(t){case b.CLICKED:W.src=`${n}/clicked.png`;break;case b.LISTENING:W.src=`${n}/listening.png`;break;case b.TALKING:W.src=`${n}/talking.png`;break;default:W.src=`${n}/idle.png`}}function ot(t){const e=`themes/${t}`;W.src=`${e}/idle.png`}function Sn(){return We[Math.floor(Math.random()*We.length)]}function Fe(t){console.log("[Character] Clicked"),!(t.target===ie||ie.contains(t.target))&&(!Cn.classList.contains("hidden")||h.isTyping||h.hasDragged||On())}function On(){S(b.CLICKED),R(Sn()),setTimeout(()=>{Xe(),S(b.LISTENING)},1500)}let $e=!1;function Rn(t){if(t.target===ie||ie.contains(t.target)||h.isWindowLocked)return;h.isDragging=!0,h.hasDragged=!1,tt=t.clientX,nt=t.clientY;const e=C.getBoundingClientRect();it=e.left,st=e.top,C.setPointerCapture(t.pointerId),h.isDragging=!0,document.body.classList.add("is-dragging"),Lt(()=>Promise.resolve().then(()=>Ot),void 0).then(n=>{n.getCurrentWindow().setIgnoreCursorEvents(!1)})}function Tn(t){if(!h.isDragging)return;const e=t.clientX-tt,n=t.clientY-nt;(Math.abs(e)>3||Math.abs(n)>3)&&(h.hasDragged=!0);let i=it+e,s=st+n;const o=C.getBoundingClientRect(),r=o.width,l=o.height,c=window.innerWidth-r,p=window.innerHeight-l;i=Math.max(0,Math.min(i,c)),s=Math.max(0,Math.min(s,p)),$e||($e=!0,C.style.right="auto",C.style.bottom="auto"),C.style.left=`${i}px`,C.style.top=`${s}px`}const se=document.getElementById("settings-panel"),An=document.getElementById("backpack"),Ln=document.getElementById("close-settings"),Nn=document.getElementById("save-settings"),at=document.getElementById("api-provider"),rt=document.getElementById("api-key"),P=document.getElementById("gemini-model"),N=document.getElementById("custom-model-input"),lt=document.getElementById("character-name"),ct=document.getElementById("theme-select"),ut=document.querySelectorAll("#personality-traits input"),dt=document.getElementById("debug-mode");function Dn(){An.addEventListener("click",t=>{t.stopPropagation(),Mn()}),Ln.addEventListener("click",ge),se.addEventListener("click",t=>{t.target===se&&ge()}),Nn.addEventListener("click",kn),P.addEventListener("change",()=>{P.value==="custom"?(N.classList.remove("hidden"),N.focus()):N.classList.add("hidden")})}function ht(t){h.config=t,at.value=t.provider||"gemini",rt.value=t.geminiApiKey||t.apiKey||"";const e=t.geminiModel||"gemini-2.0-flash";!Array.from(P.options).some(i=>i.value===e)?(P.value="custom",N.value=e,N.classList.remove("hidden")):(P.value=e,N.classList.add("hidden")),lt.value=t.characterName||"Foxy",ct.value=t.theme||"fox",ut.forEach(i=>{i.checked=(t.personality||["helpful","quirky","playful"]).includes(i.value)}),dt.checked=t.debugMode||!1,document.body.classList.toggle("debug-mode",t.debugMode||!1),ot(t.theme||"fox")}function Mn(){se.classList.remove("hidden")}function ge(){se.classList.add("hidden")}async function kn(){const t=[];ut.forEach(i=>{i.checked&&t.push(i.value)});let e=P.value;e==="custom"&&(e=N.value.trim()||"gemini-2.0-flash");const n={provider:at.value,geminiApiKey:rt.value,geminiModel:e,characterName:lt.value,theme:ct.value,personality:t,debugMode:dt.checked};try{await a("save_config",{config:n}),ht(n),ge(),R("Settings saved! âœ¨"),setTimeout(Y,2e3)}catch(i){console.error("Failed to save config",i),R("Error saving settings! ðŸ˜¢")}}async function xn(){console.log("[Renderer] Initializing (Tauri)...");const t={theme:"fox"};Rt(),In(),yn(),Dn(),ht(t),await oe("shortcut",e=>{if(e.payload.name==="toggle_chat")_n();else if(e.payload.name==="toggle_drag"){const n=document.body.classList.toggle("drag-mode-active");console.log(`[Renderer] Drag Mode: ${n?"ON":"OFF"}`)}}),console.log("[Renderer] Ready!")}window.addEventListener("DOMContentLoaded",()=>{xn()});
