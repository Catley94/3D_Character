(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const m of c.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function o(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(i){if(i.ep)return;i.ep=!0;const c=o(i);fetch(i.href,c)}})();const r={IDLE:"idle",CLICKED:"clicked",LISTENING:"listening",TALKING:"talking"},n={currentState:r.IDLE,config:{},isTyping:!1,hasDragged:!1,isDragging:!1,isWindowLocked:!1};function re(){console.log("[Interactions] Setting up click-through (Manual CSS Hover Mode)...");const e=document.getElementById("character"),t=document.getElementById("backpack"),o=document.getElementById("speech-bubble"),s=document.getElementById("chat-input-container"),i=document.getElementById("chat-input"),c=document.getElementById("send-btn"),m=document.getElementById("settings-panel"),D=document.getElementById("drag-handle"),A=document.getElementById("close-settings"),N=document.getElementById("save-settings");document.getElementById("character-container");const H=[{el:e,id:"character"},{el:t,id:"backpack"},{el:o,id:"speech-bubble"},{el:s,id:"chat-input-container"},{el:i,id:"chat-input"},{el:c,id:"send-btn"},{el:D,id:"drag-handle"},{el:A,id:"close-settings"},{el:N,id:"save-settings"}].filter(u=>!!u.el);console.log(`[Interactions] Tracking ${H.length} elements for manual hover`);function ce(u,h,p){if(!p||p.classList.contains("hidden"))return!1;if(p.id==="settings-panel"&&!p.classList.contains("hidden"))return!0;const g=p.getBoundingClientRect();return u>=g.left&&u<=g.right&&h>=g.top&&h<=g.bottom}window.electronAPI.onCursorPosition(u=>{const{x:h,y:p}=u;let g=!1;m&&!m.classList.contains("hidden")&&(g=!0),H.forEach(ae=>{const E=ae.el;ce(h,p,E)&&!n.isDragging?(E.classList.contains("manual-hover")||E.classList.add("manual-hover"),g=!0):(E.classList.contains("manual-hover")&&E.classList.remove("manual-hover"),n.isDragging&&(g=!0))}),n.isDragging||window.electronAPI.setOverInteractive(g)}),window.electronAPI.onCursorBoundsChanged(u=>{u.inBounds||(H.forEach(h=>{h.el&&h.el.classList.contains("manual-hover")&&h.el.classList.remove("manual-hover")}),window.electronAPI.setIgnoreMouseEvents(!0,{forward:!0}))}),window.addEventListener("mousemove",u=>{}),console.log("[Interactions] Setup complete - listening for cursor-position")}const b=document.getElementById("speech-bubble"),v=document.getElementById("bubble-text"),de=document.getElementById("bubble-dismiss"),B=document.getElementById("chat-input-container"),a=document.getElementById("chat-input"),le=document.getElementById("send-btn"),ue=180,ge=60,me=30,he=200,fe=320,F=15e3,pe=6e4;let L=null,k=null;function Ie(){le.addEventListener("click",R),a.addEventListener("keypress",e=>{e.key==="Enter"&&R()}),de.addEventListener("click",()=>{be()}),a.addEventListener("click",()=>{window.electronAPI.setWindowFocusable(!0),setTimeout(()=>a.focus(),50)}),a.addEventListener("focus",()=>{console.log("[Chat] Input received focus event")}),a.addEventListener("input",()=>{L&&(S(),L=setTimeout(()=>{q("Still there? I'm going to nap! ðŸ˜´")},F))})}function f(e,t=!0){b.classList.remove("hidden"),t?Le(e):(v.textContent=e,setTimeout(y,50))}function C(){b.classList.add("hidden"),v.textContent="",y()}function ye(){n.isWindowLocked=!0,window.electronAPI.setWindowLocked(!0),document.body.classList.add("window-locked")}function x(){n.isWindowLocked=!1,window.electronAPI.setWindowLocked(!1),document.body.classList.remove("window-locked")}function ve(){let e=ue;return b.classList.contains("hidden")||(e+=b.offsetHeight+10),B.classList.contains("hidden")||(e+=ge),e+me}function y(){const t=!b.classList.contains("hidden")||!B.classList.contains("hidden")?fe:he,o=ve();window.electronAPI.setWindowSize(t,o)}async function Le(e){if(!n.isTyping){n.isTyping=!0;try{v.innerHTML="";const t=document.createElement("span");t.className="typing-cursor";for(let o=0;o<e.length&&!b.classList.contains("hidden");o++)v.textContent=e.substring(0,o+1),v.appendChild(t),o%10===0&&y(),await new Promise(s=>setTimeout(s,30+Math.random()*20));y(),setTimeout(()=>t.remove(),1e3)}catch(t){console.error("Typing error:",t),v.textContent=e}finally{n.isTyping=!1}}}function we(){l(r.LISTENING),f("Hi there! What's up?"),Y()}function Y(){B.classList.remove("hidden"),window.electronAPI.setWindowFocusable(!0),setTimeout(()=>{a.focus(),console.log("[Chat] Input focused after focusable delay")},100),y(),S(),L=setTimeout(()=>{q("Taking a quick nap... poke me anytime! ðŸ˜´")},F)}function X(){B.classList.add("hidden"),a.value="",S(),window.electronAPI.setWindowFocusable(!1),y()}function S(){L&&(clearTimeout(L),L=null)}function O(){k&&(clearTimeout(k),k=null)}function be(){O(),C(),B.classList.contains("hidden")&&y()}function q(e){X(),C(),O(),e&&(f(e),k=setTimeout(C,3e3)),l(r.IDLE)}function Ee(){l(r.IDLE),O(),k=setTimeout(()=>{C(),X()},pe)}async function R(){const e=a.value.trim();if(e){a.value="",a.disabled=!0,S(),ye(),l(r.LISTENING),f("Hmm, let me think... ðŸ¤”",!1);try{const t=await window.electronAPI.sendMessage(e,n.config);t.error?(l(r.TALKING),f(`Oops! ${t.error} ðŸ˜…`)):(l(r.TALKING),await f(t.response)),x(),a.disabled=!1,a.focus(),Ee()}catch(t){console.error("Error sending message:",t),l(r.TALKING),f("Something went wrong! ðŸ˜µ"),x(),setTimeout(()=>{a.disabled=!1,a.focus(),l(r.LISTENING)},2e3)}}}const z=document.getElementById("character"),d=document.getElementById("character-container"),T=document.getElementById("character-img"),P=document.getElementById("backpack"),Te=document.getElementById("chat-input-container"),G=["Oh! I felt that! ðŸ˜Š How're you doing?","Hey there! *wiggles ears* What's up?","Ooh, a poke! Got something on your mind?","*blinks* Hello, friend! Need me?","Ah! You found me! ðŸ¦Š What can I do for you?"];let U,j,J,Q;function ke(){z.addEventListener("click",$),V(n.config.theme||"fox"),d.addEventListener("pointerdown",Pe),d.addEventListener("pointermove",Me),d.addEventListener("pointerup",e=>{n.isDragging&&(n.isDragging=!1,window.electronAPI.setDragging(!1),document.body.classList.remove("is-dragging"),d.releasePointerCapture(e.pointerId),n.hasDragged||$(e))}),d.addEventListener("lostpointercapture",()=>{n.isDragging&&(n.isDragging=!1,window.electronAPI.setDragging(!1),document.body.classList.remove("is-dragging"))})}function l(e){n.currentState=e,z.className=`state-${e}`;const o=`themes/${n.config.theme||"fox"}`;switch(e){case r.CLICKED:T.src=`${o}/clicked.png`;break;case r.LISTENING:T.src=`${o}/listening.png`;break;case r.TALKING:T.src=`${o}/talking.png`;break;default:T.src=`${o}/idle.png`}}function V(e){const t=`themes/${e}`;T.src=`${t}/idle.png`}function Ce(){return G[Math.floor(Math.random()*G.length)]}function $(e){console.log("[Character] Clicked"),!(e.target===P||P.contains(e.target))&&(!Te.classList.contains("hidden")||n.isTyping||n.hasDragged||Be())}function Be(){l(r.CLICKED),f(Ce()),setTimeout(()=>{Y(),l(r.LISTENING)},1500)}let K=!1;function Pe(e){if(e.target===P||P.contains(e.target)||n.isWindowLocked)return;n.isDragging=!0,n.hasDragged=!1,U=e.clientX,j=e.clientY;const t=d.getBoundingClientRect();J=t.left,Q=t.top,d.setPointerCapture(e.pointerId),window.electronAPI.setDragging(!0),document.body.classList.add("is-dragging"),window.electronAPI.setIgnoreMouseEvents(!1)}function Me(e){if(!n.isDragging)return;const t=e.clientX-U,o=e.clientY-j;(Math.abs(t)>3||Math.abs(o)>3)&&(n.hasDragged=!0);let s=J+t,i=Q+o;const c=d.getBoundingClientRect(),m=c.width,D=c.height,A=window.innerWidth-m,N=window.innerHeight-D;s=Math.max(0,Math.min(s,A)),i=Math.max(0,Math.min(i,N)),K||(K=!0,d.style.right="auto",d.style.bottom="auto"),d.style.left=`${s}px`,d.style.top=`${i}px`}const M=document.getElementById("settings-panel"),Se=document.getElementById("backpack"),De=document.getElementById("close-settings"),Ae=document.getElementById("save-settings"),Z=document.getElementById("api-provider"),ee=document.getElementById("api-key"),w=document.getElementById("gemini-model"),I=document.getElementById("custom-model-input"),te=document.getElementById("character-name"),ne=document.getElementById("theme-select"),oe=document.querySelectorAll("#personality-traits input"),ie=document.getElementById("debug-mode");function Ne(){Se.addEventListener("click",e=>{e.stopPropagation(),_()}),De.addEventListener("click",W),M.addEventListener("click",e=>{e.target===M&&W()}),Ae.addEventListener("click",He),w.addEventListener("change",()=>{w.value==="custom"?(I.classList.remove("hidden"),I.focus()):I.classList.add("hidden")}),window.electronAPI.onOpenSettings(()=>_())}function se(e){n.config=e,Z.value=e.provider||"gemini",ee.value=e.apiKey||"";const t=e.geminiModel||"gemini-2.0-flash";!Array.from(w.options).some(s=>s.value===t)?(w.value="custom",I.value=t,I.classList.remove("hidden")):(w.value=t,I.classList.add("hidden")),te.value=e.characterName||"Foxy",ne.value=e.theme||"fox",oe.forEach(s=>{s.checked=(e.personality||["helpful","quirky","playful"]).includes(s.value)}),ie.checked=e.debugMode||!1,document.body.classList.toggle("debug-mode",e.debugMode||!1),V(e.theme||"fox")}function _(){M.classList.remove("hidden")}function W(){M.classList.add("hidden")}async function He(){const e=[];oe.forEach(s=>{s.checked&&e.push(s.value)});let t=w.value;t==="custom"&&(t=I.value.trim()||"gemini-2.0-flash");const o={provider:Z.value,apiKey:ee.value,geminiModel:t,characterName:te.value,theme:ne.value,personality:e,debugMode:ie.checked};await window.electronAPI.saveConfig(o),se(o),W(),f("Settings saved! âœ¨"),setTimeout(C,2e3)}async function We(){console.log("[Renderer] Initializing...");const e=await window.electronAPI.loadConfig();re(),ke(),Ie(),Ne(),se(e),window.electronAPI.onActivateChat(()=>{we()}),window.electronAPI.onToggleDragMode(t=>{t?(document.body.classList.add("drag-mode-active"),console.log("[Renderer] Drag Mode ON")):(document.body.classList.remove("drag-mode-active"),console.log("[Renderer] Drag Mode OFF"))}),console.log("[Renderer] Ready!")}window.addEventListener("DOMContentLoaded",()=>{We()});
