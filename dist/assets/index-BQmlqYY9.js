(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&c(m)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const a={IDLE:"idle",CLICKED:"clicked",LISTENING:"listening",TALKING:"talking"},o={currentState:a.IDLE,config:{},isTyping:!1,hasDragged:!1,isDragging:!1,isWindowLocked:!1};function Z(){console.log("[Interactions] Setting up click-through (Polling Mode)...");const e=document.getElementById("character"),t=document.getElementById("backpack"),n=document.getElementById("speech-bubble"),c=document.getElementById("chat-input-container"),i=document.getElementById("settings-panel");console.log("[Interactions] Init. Char matching:",!!e);function s(g,b,d){if(!d||d.classList.contains("hidden"))return!1;if(d.id==="settings-panel"&&!d.classList.contains("hidden"))return!0;const l=d.getBoundingClientRect();return g>=l.left&&g<=l.right&&b>=l.top&&b<=l.bottom}async function m(){try{const g=await window.electronAPI.getCursorScreenPoint(),b=await window.electronAPI.getWindowBounds(),d=g.x-b.x,l=g.y-b.y;if(o.isDragging){requestAnimationFrame(m);return}if(i&&!i.classList.contains("hidden")){window.electronAPI.setIgnoreMouseEvents(!1),requestAnimationFrame(m);return}s(d,l,e)||s(d,l,t)||s(d,l,n)||s(d,l,c)?window.electronAPI.setIgnoreMouseEvents(!1):window.electronAPI.setIgnoreMouseEvents(!0,{forward:!0})}catch(g){console.error("Polling error:",g)}setTimeout(m,100)}m(),window.addEventListener("mousemove",g=>{})}const E=document.getElementById("speech-bubble"),I=document.getElementById("bubble-text"),ee=document.getElementById("bubble-dismiss"),T=document.getElementById("chat-input-container"),r=document.getElementById("chat-input"),te=document.getElementById("send-btn"),ne=180,oe=60,ie=30,se=200,ce=320,x=15e3,ae=6e4;let y=null,v=null;function re(){te.addEventListener("click",G),r.addEventListener("keypress",e=>{e.key==="Enter"&&G()}),ee.addEventListener("click",()=>{ge()}),r.addEventListener("input",()=>{y&&(S(),y=setTimeout(()=>{R("Still there? I'm going to nap! ðŸ˜´")},x))})}function h(e,t=!0){E.classList.remove("hidden"),t?ue(e):(I.textContent=e,setTimeout(p,50))}function k(){E.classList.add("hidden"),I.textContent="",p()}function de(){o.isWindowLocked=!0,window.electronAPI.setWindowLocked(!0),document.body.classList.add("window-locked")}function W(){o.isWindowLocked=!1,window.electronAPI.setWindowLocked(!1),document.body.classList.remove("window-locked")}function le(){let e=ne;return E.classList.contains("hidden")||(e+=E.offsetHeight+10),T.classList.contains("hidden")||(e+=oe),e+ie}function p(){const t=!E.classList.contains("hidden")||!T.classList.contains("hidden")?ce:se,n=le();window.electronAPI.setWindowSize(t,n)}async function ue(e){if(!o.isTyping){o.isTyping=!0;try{I.innerHTML="";const t=document.createElement("span");t.className="typing-cursor";for(let n=0;n<e.length&&!E.classList.contains("hidden");n++)I.textContent=e.substring(0,n+1),I.appendChild(t),n%10===0&&p(),await new Promise(c=>setTimeout(c,30+Math.random()*20));p(),setTimeout(()=>t.remove(),1e3)}catch(t){console.error("Typing error:",t),I.textContent=e}finally{o.isTyping=!1}}}function me(){T.classList.remove("hidden"),r.focus(),p(),S(),y=setTimeout(()=>{R("Taking a quick nap... poke me anytime! ðŸ˜´")},x)}function K(){T.classList.add("hidden"),r.value="",S(),p()}function S(){y&&(clearTimeout(y),y=null)}function D(){v&&(clearTimeout(v),v=null)}function ge(){D(),k(),T.classList.contains("hidden")&&p()}function R(e){K(),k(),D(),e&&(h(e),v=setTimeout(k,3e3)),u(a.IDLE)}function he(){u(a.IDLE),D(),v=setTimeout(()=>{k(),K()},ae)}async function G(){const e=r.value.trim();if(e){r.value="",r.disabled=!0,S(),de(),u(a.LISTENING),h("Hmm, let me think... ðŸ¤”",!1);try{const t=await window.electronAPI.sendMessage(e,o.config);t.error?(u(a.TALKING),h(`Oops! ${t.error} ðŸ˜…`)):(u(a.TALKING),await h(t.response)),W(),r.disabled=!1,r.focus(),he()}catch(t){console.error("Error sending message:",t),u(a.TALKING),h("Something went wrong! ðŸ˜µ"),W(),setTimeout(()=>{r.disabled=!1,r.focus(),u(a.LISTENING)},2e3)}}}const P=document.getElementById("character"),L=document.getElementById("character-img"),C=document.getElementById("backpack"),fe=document.getElementById("chat-input-container"),H=["Oh! I felt that! ðŸ˜Š How're you doing?","Hey there! *wiggles ears* What's up?","Ooh, a poke! Got something on your mind?","*blinks* Hello, friend! Need me?","Ah! You found me! ðŸ¦Š What can I do for you?"];let M,N,$,Y,_,X;function pe(){P.addEventListener("click",ye),P.addEventListener("mousedown",Ee),document.addEventListener("mousemove",be),document.addEventListener("mouseup",()=>{o.isDragging=!1}),q(o.config.theme||"fox")}function u(e){o.currentState=e,P.className=`state-${e}`;const n=`themes/${o.config.theme||"fox"}`;switch(e){case a.CLICKED:L.src=`${n}/clicked.png`;break;case a.LISTENING:L.src=`${n}/listening.png`;break;case a.TALKING:L.src=`${n}/talking.png`;break;default:L.src=`${n}/idle.png`}}function q(e){const t=`themes/${e}`;L.src=`${t}/idle.png`}function Ie(){return H[Math.floor(Math.random()*H.length)]}function ye(e){console.log("[Character] Clicked"),!(e.target===C||C.contains(e.target))&&(!fe.classList.contains("hidden")||o.isTyping||o.hasDragged||(console.log("[Character] Clicked"),we()))}function we(){u(a.CLICKED),h(Ie()),setTimeout(()=>{me(),u(a.LISTENING)},1500)}async function Ee(e){if(e.target===C||C.contains(e.target)||o.isWindowLocked)return;o.isDragging=!0,o.hasDragged=!1,M=e.screenX,N=e.screenY;const t=await window.electronAPI.getWindowBounds();$=t.x,Y=t.y,_=t.width,X=t.height,e.preventDefault()}function be(e){if(!o.isDragging)return;const t=$+(e.screenX-M),n=Y+(e.screenY-N);(Math.abs(e.screenX-M)>3||Math.abs(e.screenY-N)>3)&&(o.hasDragged=!0),window.electronAPI.setWindowPosition(t,n,_,X)}const B=document.getElementById("settings-panel"),Le=document.getElementById("backpack"),ve=document.getElementById("close-settings"),ke=document.getElementById("save-settings"),F=document.getElementById("api-provider"),z=document.getElementById("api-key"),w=document.getElementById("gemini-model"),f=document.getElementById("custom-model-input"),U=document.getElementById("character-name"),j=document.getElementById("theme-select"),J=document.querySelectorAll("#personality-traits input"),Q=document.getElementById("debug-mode");function Te(){Le.addEventListener("click",e=>{e.stopPropagation(),O()}),ve.addEventListener("click",A),B.addEventListener("click",e=>{e.target===B&&A()}),ke.addEventListener("click",Ce),w.addEventListener("change",()=>{w.value==="custom"?(f.classList.remove("hidden"),f.focus()):f.classList.add("hidden")}),window.electronAPI.onOpenSettings(()=>O())}function V(e){o.config=e,F.value=e.provider||"gemini",z.value=e.apiKey||"";const t=e.geminiModel||"gemini-2.0-flash";!Array.from(w.options).some(c=>c.value===t)?(w.value="custom",f.value=t,f.classList.remove("hidden")):(w.value=t,f.classList.add("hidden")),U.value=e.characterName||"Foxy",j.value=e.theme||"fox",J.forEach(c=>{c.checked=(e.personality||["helpful","quirky","playful"]).includes(c.value)}),Q.checked=e.debugMode||!1,document.body.classList.toggle("debug-mode",e.debugMode||!1),q(e.theme||"fox")}function O(){B.classList.remove("hidden")}function A(){B.classList.add("hidden")}async function Ce(){const e=[];J.forEach(c=>{c.checked&&e.push(c.value)});let t=w.value;t==="custom"&&(t=f.value.trim()||"gemini-2.0-flash");const n={provider:F.value,apiKey:z.value,geminiModel:t,characterName:U.value,theme:j.value,personality:e,debugMode:Q.checked};await window.electronAPI.saveConfig(n),V(n),A(),h("Settings saved! âœ¨"),setTimeout(k,2e3)}async function Be(){console.log("[Renderer] Initializing...");const e=await window.electronAPI.loadConfig();Z(),pe(),re(),Te(),V(e),console.log("[Renderer] Ready!")}window.addEventListener("DOMContentLoaded",()=>{Be()});
