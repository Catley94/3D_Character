(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();function m(t,e,n,i){if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)}function J(t,e,n,i,s){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n}var F,R,U,fe,pe;const _="__TAURI_TO_IPC_KEY__";function mt(t,e=!1){return window.__TAURI_INTERNALS__.transformCallback(t,e)}class Ut{constructor(e){F.set(this,void 0),R.set(this,0),U.set(this,[]),fe.set(this,void 0),J(this,F,e||(()=>{})),this.id=mt(n=>{const i=n.index;if("end"in n){i==m(this,R,"f")?this.cleanupCallback():J(this,fe,i);return}const s=n.message;if(i==m(this,R,"f")){for(m(this,F,"f").call(this,s),J(this,R,m(this,R,"f")+1);m(this,R,"f")in m(this,U,"f");){const o=m(this,U,"f")[m(this,R,"f")];m(this,F,"f").call(this,o),delete m(this,U,"f")[m(this,R,"f")],J(this,R,m(this,R,"f")+1)}m(this,R,"f")===m(this,fe,"f")&&this.cleanupCallback()}else m(this,U,"f")[i]=s})}cleanupCallback(){window.__TAURI_INTERNALS__.unregisterCallback(this.id)}set onmessage(e){J(this,F,e)}get onmessage(){return m(this,F,"f")}[(F=new WeakMap,R=new WeakMap,U=new WeakMap,fe=new WeakMap,_)](){return`__CHANNEL__:${this.id}`}toJSON(){return this[_]()}}async function r(t,e={},n){return window.__TAURI_INTERNALS__.invoke(t,e,n)}class Kt{get rid(){return m(this,pe,"f")}constructor(e){pe.set(this,void 0),J(this,pe,e)}async close(){return r("plugin:resources|close",{rid:this.rid})}}pe=new WeakMap;class de{constructor(...e){this.type="Logical",e.length===1?"Logical"in e[0]?(this.width=e[0].Logical.width,this.height=e[0].Logical.height):(this.width=e[0].width,this.height=e[0].height):(this.width=e[0],this.height=e[1])}toPhysical(e){return new P(this.width*e,this.height*e)}[_](){return{width:this.width,height:this.height}}toJSON(){return this[_]()}}class P{constructor(...e){this.type="Physical",e.length===1?"Physical"in e[0]?(this.width=e[0].Physical.width,this.height=e[0].Physical.height):(this.width=e[0].width,this.height=e[0].height):(this.width=e[0],this.height=e[1])}toLogical(e){return new de(this.width/e,this.height/e)}[_](){return{width:this.width,height:this.height}}toJSON(){return this[_]()}}class K{constructor(e){this.size=e}toLogical(e){return this.size instanceof de?this.size:this.size.toLogical(e)}toPhysical(e){return this.size instanceof P?this.size:this.size.toPhysical(e)}[_](){return{[`${this.size.type}`]:{width:this.size.width,height:this.size.height}}}toJSON(){return this[_]()}}class wt{constructor(...e){this.type="Logical",e.length===1?"Logical"in e[0]?(this.x=e[0].Logical.x,this.y=e[0].Logical.y):(this.x=e[0].x,this.y=e[0].y):(this.x=e[0],this.y=e[1])}toPhysical(e){return new O(this.x*e,this.y*e)}[_](){return{x:this.x,y:this.y}}toJSON(){return this[_]()}}class O{constructor(...e){this.type="Physical",e.length===1?"Physical"in e[0]?(this.x=e[0].Physical.x,this.y=e[0].Physical.y):(this.x=e[0].x,this.y=e[0].y):(this.x=e[0],this.y=e[1])}toLogical(e){return new wt(this.x/e,this.y/e)}[_](){return{x:this.x,y:this.y}}toJSON(){return this[_]()}}class ye{constructor(e){this.position=e}toLogical(e){return this.position instanceof wt?this.position:this.position.toLogical(e)}toPhysical(e){return this.position instanceof O?this.position:this.position.toPhysical(e)}[_](){return{[`${this.position.type}`]:{x:this.position.x,y:this.position.y}}}toJSON(){return this[_]()}}var C;(function(t){t.WINDOW_RESIZED="tauri://resize",t.WINDOW_MOVED="tauri://move",t.WINDOW_CLOSE_REQUESTED="tauri://close-requested",t.WINDOW_DESTROYED="tauri://destroyed",t.WINDOW_FOCUS="tauri://focus",t.WINDOW_BLUR="tauri://blur",t.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",t.WINDOW_THEME_CHANGED="tauri://theme-changed",t.WINDOW_CREATED="tauri://window-created",t.WEBVIEW_CREATED="tauri://webview-created",t.DRAG_ENTER="tauri://drag-enter",t.DRAG_OVER="tauri://drag-over",t.DRAG_DROP="tauri://drag-drop",t.DRAG_LEAVE="tauri://drag-leave"})(C||(C={}));async function bt(t,e){window.__TAURI_EVENT_PLUGIN_INTERNALS__.unregisterListener(t,e),await r("plugin:event|unlisten",{event:t,eventId:e})}async function ve(t,e,n){var i;const s=typeof(n==null?void 0:n.target)=="string"?{kind:"AnyLabel",label:n.target}:(i=n==null?void 0:n.target)!==null&&i!==void 0?i:{kind:"Any"};return r("plugin:event|listen",{event:t,target:s,handler:mt(e)}).then(o=>async()=>bt(t,o))}async function Yt(t,e,n){return ve(t,i=>{bt(t,i.id),e(i)},n)}async function jt(t,e){await r("plugin:event|emit",{event:t,payload:e})}async function Vt(t,e,n){await r("plugin:event|emit_to",{target:typeof t=="string"?{kind:"AnyLabel",label:t}:t,event:e,payload:n})}class se extends Kt{constructor(e){super(e)}static async new(e,n,i){return r("plugin:image|new",{rgba:be(e),width:n,height:i}).then(s=>new se(s))}static async fromBytes(e){return r("plugin:image|from_bytes",{bytes:be(e)}).then(n=>new se(n))}static async fromPath(e){return r("plugin:image|from_path",{path:e}).then(n=>new se(n))}async rgba(){return r("plugin:image|rgba",{rid:this.rid}).then(e=>new Uint8Array(e))}async size(){return r("plugin:image|size",{rid:this.rid})}}function be(t){return t==null?null:typeof t=="string"?t:t instanceof se?t.rid:t}var Ae;(function(t){t[t.Critical=1]="Critical",t[t.Informational=2]="Informational"})(Ae||(Ae={}));class qt{constructor(e){this._preventDefault=!1,this.event=e.event,this.id=e.id}preventDefault(){this._preventDefault=!0}isPreventDefault(){return this._preventDefault}}var Be;(function(t){t.None="none",t.Normal="normal",t.Indeterminate="indeterminate",t.Paused="paused",t.Error="error"})(Be||(Be={}));function T(){return new vt(window.__TAURI_INTERNALS__.metadata.currentWindow.label,{skip:!0})}async function Te(){return r("plugin:window|get_all_windows").then(t=>t.map(e=>new vt(e,{skip:!0})))}const Re=["tauri://created","tauri://error"];class vt{constructor(e,n={}){var i;this.label=e,this.listeners=Object.create(null),n!=null&&n.skip||r("plugin:window|create",{options:{...n,parent:typeof n.parent=="string"?n.parent:(i=n.parent)===null||i===void 0?void 0:i.label,label:e}}).then(async()=>this.emit("tauri://created")).catch(async s=>this.emit("tauri://error",s))}static async getByLabel(e){var n;return(n=(await Te()).find(i=>i.label===e))!==null&&n!==void 0?n:null}static getCurrent(){return T()}static async getAll(){return Te()}static async getFocusedWindow(){for(const e of await Te())if(await e.isFocused())return e;return null}async listen(e,n){return this._handleTauriEvent(e,n)?()=>{const i=this.listeners[e];i.splice(i.indexOf(n),1)}:ve(e,n,{target:{kind:"Window",label:this.label}})}async once(e,n){return this._handleTauriEvent(e,n)?()=>{const i=this.listeners[e];i.splice(i.indexOf(n),1)}:Yt(e,n,{target:{kind:"Window",label:this.label}})}async emit(e,n){if(Re.includes(e)){for(const i of this.listeners[e]||[])i({event:e,id:-1,payload:n});return}return jt(e,n)}async emitTo(e,n,i){if(Re.includes(n)){for(const s of this.listeners[n]||[])s({event:n,id:-1,payload:i});return}return Vt(e,n,i)}_handleTauriEvent(e,n){return Re.includes(e)?(e in this.listeners?this.listeners[e].push(n):this.listeners[e]=[n],!0):!1}async scaleFactor(){return r("plugin:window|scale_factor",{label:this.label})}async innerPosition(){return r("plugin:window|inner_position",{label:this.label}).then(e=>new O(e))}async outerPosition(){return r("plugin:window|outer_position",{label:this.label}).then(e=>new O(e))}async innerSize(){return r("plugin:window|inner_size",{label:this.label}).then(e=>new P(e))}async outerSize(){return r("plugin:window|outer_size",{label:this.label}).then(e=>new P(e))}async isFullscreen(){return r("plugin:window|is_fullscreen",{label:this.label})}async isMinimized(){return r("plugin:window|is_minimized",{label:this.label})}async isMaximized(){return r("plugin:window|is_maximized",{label:this.label})}async isFocused(){return r("plugin:window|is_focused",{label:this.label})}async isDecorated(){return r("plugin:window|is_decorated",{label:this.label})}async isResizable(){return r("plugin:window|is_resizable",{label:this.label})}async isMaximizable(){return r("plugin:window|is_maximizable",{label:this.label})}async isMinimizable(){return r("plugin:window|is_minimizable",{label:this.label})}async isClosable(){return r("plugin:window|is_closable",{label:this.label})}async isVisible(){return r("plugin:window|is_visible",{label:this.label})}async title(){return r("plugin:window|title",{label:this.label})}async theme(){return r("plugin:window|theme",{label:this.label})}async isAlwaysOnTop(){return r("plugin:window|is_always_on_top",{label:this.label})}async center(){return r("plugin:window|center",{label:this.label})}async requestUserAttention(e){let n=null;return e&&(e===Ae.Critical?n={type:"Critical"}:n={type:"Informational"}),r("plugin:window|request_user_attention",{label:this.label,value:n})}async setResizable(e){return r("plugin:window|set_resizable",{label:this.label,value:e})}async setEnabled(e){return r("plugin:window|set_enabled",{label:this.label,value:e})}async isEnabled(){return r("plugin:window|is_enabled",{label:this.label})}async setMaximizable(e){return r("plugin:window|set_maximizable",{label:this.label,value:e})}async setMinimizable(e){return r("plugin:window|set_minimizable",{label:this.label,value:e})}async setClosable(e){return r("plugin:window|set_closable",{label:this.label,value:e})}async setTitle(e){return r("plugin:window|set_title",{label:this.label,value:e})}async maximize(){return r("plugin:window|maximize",{label:this.label})}async unmaximize(){return r("plugin:window|unmaximize",{label:this.label})}async toggleMaximize(){return r("plugin:window|toggle_maximize",{label:this.label})}async minimize(){return r("plugin:window|minimize",{label:this.label})}async unminimize(){return r("plugin:window|unminimize",{label:this.label})}async show(){return r("plugin:window|show",{label:this.label})}async hide(){return r("plugin:window|hide",{label:this.label})}async close(){return r("plugin:window|close",{label:this.label})}async destroy(){return r("plugin:window|destroy",{label:this.label})}async setDecorations(e){return r("plugin:window|set_decorations",{label:this.label,value:e})}async setShadow(e){return r("plugin:window|set_shadow",{label:this.label,value:e})}async setEffects(e){return r("plugin:window|set_effects",{label:this.label,value:e})}async clearEffects(){return r("plugin:window|set_effects",{label:this.label,value:null})}async setAlwaysOnTop(e){return r("plugin:window|set_always_on_top",{label:this.label,value:e})}async setAlwaysOnBottom(e){return r("plugin:window|set_always_on_bottom",{label:this.label,value:e})}async setContentProtected(e){return r("plugin:window|set_content_protected",{label:this.label,value:e})}async setSize(e){return r("plugin:window|set_size",{label:this.label,value:e instanceof K?e:new K(e)})}async setMinSize(e){return r("plugin:window|set_min_size",{label:this.label,value:e instanceof K?e:e?new K(e):null})}async setMaxSize(e){return r("plugin:window|set_max_size",{label:this.label,value:e instanceof K?e:e?new K(e):null})}async setSizeConstraints(e){function n(i){return i?{Logical:i}:null}return r("plugin:window|set_size_constraints",{label:this.label,value:{minWidth:n(e==null?void 0:e.minWidth),minHeight:n(e==null?void 0:e.minHeight),maxWidth:n(e==null?void 0:e.maxWidth),maxHeight:n(e==null?void 0:e.maxHeight)}})}async setPosition(e){return r("plugin:window|set_position",{label:this.label,value:e instanceof ye?e:new ye(e)})}async setFullscreen(e){return r("plugin:window|set_fullscreen",{label:this.label,value:e})}async setSimpleFullscreen(e){return r("plugin:window|set_simple_fullscreen",{label:this.label,value:e})}async setFocus(){return r("plugin:window|set_focus",{label:this.label})}async setFocusable(e){return r("plugin:window|set_focusable",{label:this.label,value:e})}async setIcon(e){return r("plugin:window|set_icon",{label:this.label,value:be(e)})}async setSkipTaskbar(e){return r("plugin:window|set_skip_taskbar",{label:this.label,value:e})}async setCursorGrab(e){return r("plugin:window|set_cursor_grab",{label:this.label,value:e})}async setCursorVisible(e){return r("plugin:window|set_cursor_visible",{label:this.label,value:e})}async setCursorIcon(e){return r("plugin:window|set_cursor_icon",{label:this.label,value:e})}async setBackgroundColor(e){return r("plugin:window|set_background_color",{color:e})}async setCursorPosition(e){return r("plugin:window|set_cursor_position",{label:this.label,value:e instanceof ye?e:new ye(e)})}async setIgnoreCursorEvents(e){return r("plugin:window|set_ignore_cursor_events",{label:this.label,value:e})}async startDragging(){return r("plugin:window|start_dragging",{label:this.label})}async startResizeDragging(e){return r("plugin:window|start_resize_dragging",{label:this.label,value:e})}async setBadgeCount(e){return r("plugin:window|set_badge_count",{label:this.label,value:e})}async setBadgeLabel(e){return r("plugin:window|set_badge_label",{label:this.label,value:e})}async setOverlayIcon(e){return r("plugin:window|set_overlay_icon",{label:this.label,value:e?be(e):void 0})}async setProgressBar(e){return r("plugin:window|set_progress_bar",{label:this.label,value:e})}async setVisibleOnAllWorkspaces(e){return r("plugin:window|set_visible_on_all_workspaces",{label:this.label,value:e})}async setTitleBarStyle(e){return r("plugin:window|set_title_bar_style",{label:this.label,value:e})}async setTheme(e){return r("plugin:window|set_theme",{label:this.label,value:e})}async onResized(e){return this.listen(C.WINDOW_RESIZED,n=>{n.payload=new P(n.payload),e(n)})}async onMoved(e){return this.listen(C.WINDOW_MOVED,n=>{n.payload=new O(n.payload),e(n)})}async onCloseRequested(e){return this.listen(C.WINDOW_CLOSE_REQUESTED,async n=>{const i=new qt(n);await e(i),i.isPreventDefault()||await this.destroy()})}async onDragDropEvent(e){const n=await this.listen(C.DRAG_ENTER,a=>{e({...a,payload:{type:"enter",paths:a.payload.paths,position:new O(a.payload.position)}})}),i=await this.listen(C.DRAG_OVER,a=>{e({...a,payload:{type:"over",position:new O(a.payload.position)}})}),s=await this.listen(C.DRAG_DROP,a=>{e({...a,payload:{type:"drop",paths:a.payload.paths,position:new O(a.payload.position)}})}),o=await this.listen(C.DRAG_LEAVE,a=>{e({...a,payload:{type:"leave"}})});return()=>{n(),s(),i(),o()}}async onFocusChanged(e){const n=await this.listen(C.WINDOW_FOCUS,s=>{e({...s,payload:!0})}),i=await this.listen(C.WINDOW_BLUR,s=>{e({...s,payload:!1})});return()=>{n(),i()}}async onScaleChanged(e){return this.listen(C.WINDOW_SCALE_FACTOR_CHANGED,e)}async onThemeChanged(e){return this.listen(C.WINDOW_THEME_CHANGED,e)}}var Fe;(function(t){t.Disabled="disabled",t.Throttle="throttle",t.Suspend="suspend"})(Fe||(Fe={}));var He;(function(t){t.Default="default",t.FluentOverlay="fluentOverlay"})(He||(He={}));var ze;(function(t){t.AppearanceBased="appearanceBased",t.Light="light",t.Dark="dark",t.MediumLight="mediumLight",t.UltraDark="ultraDark",t.Titlebar="titlebar",t.Selection="selection",t.Menu="menu",t.Popover="popover",t.Sidebar="sidebar",t.HeaderView="headerView",t.Sheet="sheet",t.WindowBackground="windowBackground",t.HudWindow="hudWindow",t.FullScreenUI="fullScreenUI",t.Tooltip="tooltip",t.ContentBackground="contentBackground",t.UnderWindowBackground="underWindowBackground",t.UnderPageBackground="underPageBackground",t.Mica="mica",t.Blur="blur",t.Acrylic="acrylic",t.Tabbed="tabbed",t.TabbedDark="tabbedDark",t.TabbedLight="tabbedLight"})(ze||(ze={}));var Ue;(function(t){t.FollowsWindowActiveState="followsWindowActiveState",t.Active="active",t.Inactive="inactive"})(Ue||(Ue={}));function Xt(t){return t===null?null:{name:t.name,scaleFactor:t.scaleFactor,position:new O(t.position),size:new P(t.size),workArea:{position:new O(t.workArea.position),size:new P(t.workArea.size)}}}async function ke(){return r("plugin:window|current_monitor").then(Xt)}const p={IDLE:"idle",CLICKED:"clicked",LISTENING:"listening",TALKING:"talking"},N={toggleChat:"Super+Shift+F",toggleDrag:"Super+Shift+D",toggleVisibility:"Super+Shift+H",screensaver:"Super+Shift+S"},S={currentState:p.IDLE,config:{shortcuts:N},isTyping:!1,hasDragged:!1,isDragging:!1,isWindowLocked:!1};async function _e(t,e){const n=new Ut;return n.onmessage=e,await r("plugin:global-shortcut|register",{shortcuts:Array.isArray(t)?t:[t],handler:n})}async function Ee(t){return await r("plugin:global-shortcut|unregister",{shortcuts:Array.isArray(t)?t:[t]})}async function Jt(){return await r("plugin:global-shortcut|unregister_all",{})}var Ke;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(Ke||(Ke={}));var Ye;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})(Ye||(Ye={}));var je;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(je||(je={}));const Ve=["user","model","function","system"];var qe;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(qe||(qe={}));var Xe;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Xe||(Xe={}));var Je;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(Je||(Je={}));var Ze;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})(Ze||(Ze={}));var oe;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER"})(oe||(oe={}));var Qe;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})(Qe||(Qe={}));var et;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(et||(et={}));var tt;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(tt||(tt={}));class v extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class Y extends v{constructor(e,n){super(e),this.response=n}}class _t extends v{constructor(e,n,i,s){super(e),this.status=n,this.statusText=i,this.errorDetails=s}}class G extends v{}const Zt="https://generativelanguage.googleapis.com",Qt="v1beta",en="0.21.0",tn="genai-js";var z;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(z||(z={}));class nn{constructor(e,n,i,s,o){this.model=e,this.task=n,this.apiKey=i,this.stream=s,this.requestOptions=o}toString(){var e,n;const i=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||Qt;let o=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||Zt}/${i}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}function sn(t){const e=[];return t!=null&&t.apiClient&&e.push(t.apiClient),e.push(`${tn}/${en}`),e.join(" ")}async function on(t){var e;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",sn(t.requestOptions)),n.append("x-goog-api-key",t.apiKey);let i=(e=t.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(s){throw new G(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${s.message}`)}for(const[s,o]of i.entries()){if(s==="x-goog-api-key")throw new G(`Cannot set reserved header name ${s}`);if(s==="x-goog-api-client")throw new G(`Header name ${s} can only be set using the apiClient field`);n.append(s,o)}}return n}async function an(t,e,n,i,s,o){const a=new nn(t,e,n,i,o);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},un(o)),{method:"POST",headers:await on(a),body:s})}}async function he(t,e,n,i,s,o={},a=fetch){const{url:l,fetchOptions:c}=await an(t,e,n,i,s,o);return rn(l,c,a)}async function rn(t,e,n=fetch){let i;try{i=await n(t,e)}catch(s){ln(s,t)}return i.ok||await cn(i,t),i}function ln(t,e){let n=t;throw t instanceof _t||t instanceof G||(n=new v(`Error fetching from ${e.toString()}: ${t.message}`),n.stack=t.stack),n}async function cn(t,e){let n="",i;try{const s=await t.json();n=s.error.message,s.error.details&&(n+=` ${JSON.stringify(s.error.details)}`,i=s.error.details)}catch{}throw new _t(`Error fetching from ${e.toString()}: [${t.status} ${t.statusText}] ${n}`,t.status,t.statusText,i)}function un(t){const e={};if((t==null?void 0:t.signal)!==void 0||(t==null?void 0:t.timeout)>=0){const n=new AbortController;(t==null?void 0:t.timeout)>=0&&setTimeout(()=>n.abort(),t.timeout),t!=null&&t.signal&&t.signal.addEventListener("abort",()=>{n.abort()}),e.signal=n.signal}return e}function Pe(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),me(t.candidates[0]))throw new Y(`${M(t)}`,t);return dn(t)}else if(t.promptFeedback)throw new Y(`Text not available. ${M(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),me(t.candidates[0]))throw new Y(`${M(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),nt(t)[0]}else if(t.promptFeedback)throw new Y(`Function call not available. ${M(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),me(t.candidates[0]))throw new Y(`${M(t)}`,t);return nt(t)}else if(t.promptFeedback)throw new Y(`Function call not available. ${M(t)}`,t)},t}function dn(t){var e,n,i,s;const o=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const a of(s=(i=t.candidates)===null||i===void 0?void 0:i[0].content)===null||s===void 0?void 0:s.parts)a.text&&o.push(a.text),a.executableCode&&o.push("\n```"+a.executableCode.language+`
`+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&o.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}function nt(t){var e,n,i,s;const o=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const a of(s=(i=t.candidates)===null||i===void 0?void 0:i[0].content)===null||s===void 0?void 0:s.parts)a.functionCall&&o.push(a.functionCall);if(o.length>0)return o}const hn=[oe.RECITATION,oe.SAFETY,oe.LANGUAGE];function me(t){return!!t.finishReason&&hn.includes(t.finishReason)}function M(t){var e,n,i;let s="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)s+="Response was blocked",!((e=t.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${t.promptFeedback.blockReason}`),!((n=t.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(s+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((i=t.candidates)===null||i===void 0)&&i[0]){const o=t.candidates[0];me(o)&&(s+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(s+=`: ${o.finishMessage}`))}return s}function re(t){return this instanceof re?(this.v=t,this):new re(t)}function gn(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),s,o=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(d){i[d]&&(s[d]=function(u){return new Promise(function(g,E){o.push([d,u,g,E])>1||l(d,u)})})}function l(d,u){try{c(i[d](u))}catch(g){y(o[0][3],g)}}function c(d){d.value instanceof re?Promise.resolve(d.value.v).then(h,f):y(o[0][2],d)}function h(d){l("next",d)}function f(d){l("throw",d)}function y(d,u){d(u),o.shift(),o.length&&l(o[0][0],o[0][1])}}const it=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function fn(t){const e=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=mn(e),[i,s]=n.tee();return{stream:pn(i),response:yn(s)}}async function yn(t){const e=[],n=t.getReader();for(;;){const{done:i,value:s}=await n.read();if(i)return Pe(wn(e));e.push(s)}}function pn(t){return gn(this,arguments,function*(){const n=t.getReader();for(;;){const{value:i,done:s}=yield re(n.read());if(s)break;yield yield re(Pe(i))}})}function mn(t){const e=t.getReader();return new ReadableStream({start(i){let s="";return o();function o(){return e.read().then(({value:a,done:l})=>{if(l){if(s.trim()){i.error(new v("Failed to parse stream"));return}i.close();return}s+=a;let c=s.match(it),h;for(;c;){try{h=JSON.parse(c[1])}catch{i.error(new v(`Error parsing JSON response: "${c[1]}"`));return}i.enqueue(h),s=s.substring(c[0].length),c=s.match(it)}return o()})}}})}function wn(t){const e=t[t.length-1],n={promptFeedback:e==null?void 0:e.promptFeedback};for(const i of t){if(i.candidates)for(const s of i.candidates){const o=s.index;if(n.candidates||(n.candidates=[]),n.candidates[o]||(n.candidates[o]={index:s.index}),n.candidates[o].citationMetadata=s.citationMetadata,n.candidates[o].groundingMetadata=s.groundingMetadata,n.candidates[o].finishReason=s.finishReason,n.candidates[o].finishMessage=s.finishMessage,n.candidates[o].safetyRatings=s.safetyRatings,s.content&&s.content.parts){n.candidates[o].content||(n.candidates[o].content={role:s.content.role||"user",parts:[]});const a={};for(const l of s.content.parts)l.text&&(a.text=l.text),l.functionCall&&(a.functionCall=l.functionCall),l.executableCode&&(a.executableCode=l.executableCode),l.codeExecutionResult&&(a.codeExecutionResult=l.codeExecutionResult),Object.keys(a).length===0&&(a.text=""),n.candidates[o].content.parts.push(a)}}i.usageMetadata&&(n.usageMetadata=i.usageMetadata)}return n}async function Et(t,e,n,i){const s=await he(e,z.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(n),i);return fn(s)}async function Ct(t,e,n,i){const o=await(await he(e,z.GENERATE_CONTENT,t,!1,JSON.stringify(n),i)).json();return{response:Pe(o)}}function It(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function le(t){let e=[];if(typeof t=="string")e=[{text:t}];else for(const n of t)typeof n=="string"?e.push({text:n}):e.push(n);return bn(e)}function bn(t){const e={role:"user",parts:[]},n={role:"function",parts:[]};let i=!1,s=!1;for(const o of t)"functionResponse"in o?(n.parts.push(o),s=!0):(e.parts.push(o),i=!0);if(i&&s)throw new v("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!s)throw new v("No content is provided for sending chat message.");return i?e:n}function vn(t,e){var n;let i={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(n=e==null?void 0:e.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const s=t.generateContentRequest!=null;if(t.contents){if(s)throw new G("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=t.contents}else if(s)i=Object.assign(Object.assign({},i),t.generateContentRequest);else{const o=le(t);i.contents=[o]}return{generateContentRequest:i}}function st(t){let e;return t.contents?e=t:e={contents:[le(t)]},t.systemInstruction&&(e.systemInstruction=It(t.systemInstruction)),e}function _n(t){return typeof t=="string"||Array.isArray(t)?{content:le(t)}:t}const ot=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],En={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Cn(t){let e=!1;for(const n of t){const{role:i,parts:s}=n;if(!e&&i!=="user")throw new v(`First content should be with role 'user', got ${i}`);if(!Ve.includes(i))throw new v(`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify(Ve)}`);if(!Array.isArray(s))throw new v("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new v("Each Content should have at least one part");const o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const l of s)for(const c of ot)c in l&&(o[c]+=1);const a=En[i];for(const l of ot)if(!a.includes(l)&&o[l]>0)throw new v(`Content with role '${i}' can't contain '${l}' part`);e=!0}}const at="SILENT_ERROR";class In{constructor(e,n,i,s={}){this.model=n,this.params=i,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,i!=null&&i.history&&(Cn(i.history),this._history=i.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,n={}){var i,s,o,a,l,c;await this._sendPromise;const h=le(e),f={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,h]},y=Object.assign(Object.assign({},this._requestOptions),n);let d;return this._sendPromise=this._sendPromise.then(()=>Ct(this._apiKey,this.model,f,y)).then(u=>{var g;if(u.response.candidates&&u.response.candidates.length>0){this._history.push(h);const E=Object.assign({parts:[],role:"model"},(g=u.response.candidates)===null||g===void 0?void 0:g[0].content);this._history.push(E)}else{const E=M(u.response);E&&console.warn(`sendMessage() was unsuccessful. ${E}. Inspect response object for details.`)}d=u}),await this._sendPromise,d}async sendMessageStream(e,n={}){var i,s,o,a,l,c;await this._sendPromise;const h=le(e),f={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,h]},y=Object.assign(Object.assign({},this._requestOptions),n),d=Et(this._apiKey,this.model,f,y);return this._sendPromise=this._sendPromise.then(()=>d).catch(u=>{throw new Error(at)}).then(u=>u.response).then(u=>{if(u.candidates&&u.candidates.length>0){this._history.push(h);const g=Object.assign({},u.candidates[0].content);g.role||(g.role="model"),this._history.push(g)}else{const g=M(u);g&&console.warn(`sendMessageStream() was unsuccessful. ${g}. Inspect response object for details.`)}}).catch(u=>{u.message!==at&&console.error(u)}),d}}async function Sn(t,e,n,i){return(await he(e,z.COUNT_TOKENS,t,!1,JSON.stringify(n),i)).json()}async function Tn(t,e,n,i){return(await he(e,z.EMBED_CONTENT,t,!1,JSON.stringify(n),i)).json()}async function Rn(t,e,n,i){const s=n.requests.map(a=>Object.assign(Object.assign({},a),{model:e}));return(await he(e,z.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:s}),i)).json()}class rt{constructor(e,n,i={}){this.apiKey=e,this._requestOptions=i,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=It(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(e,n={}){var i;const s=st(e),o=Object.assign(Object.assign({},this._requestOptions),n);return Ct(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},s),o)}async generateContentStream(e,n={}){var i;const s=st(e),o=Object.assign(Object.assign({},this._requestOptions),n);return Et(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},s),o)}startChat(e){var n;return new In(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},e),this._requestOptions)}async countTokens(e,n={}){const i=vn(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),n);return Sn(this.apiKey,this.model,i,s)}async embedContent(e,n={}){const i=_n(e),s=Object.assign(Object.assign({},this._requestOptions),n);return Tn(this.apiKey,this.model,i,s)}async batchEmbedContents(e,n={}){const i=Object.assign(Object.assign({},this._requestOptions),n);return Rn(this.apiKey,this.model,e,i)}}class On{constructor(e){this.apiKey=e}getGenerativeModel(e,n){if(!e.model)throw new v("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new rt(this.apiKey,e,n)}getGenerativeModelFromCachedContent(e,n,i){if(!e.name)throw new G("Cached content must contain a `name` field.");if(!e.model)throw new G("Cached content must contain a `model` field.");const s=["model","systemInstruction"];for(const a of s)if(n!=null&&n[a]&&e[a]&&(n==null?void 0:n[a])!==e[a]){if(a==="model"){const l=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,c=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(l===c)continue}throw new G(`Different value for "${a}" specified in modelParams (${n[a]}) and cachedContent (${e[a]})`)}const o=Object.assign(Object.assign({},n),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new rt(this.apiKey,o,i)}}class An{async generateResponse(e,n){if(new Date().toISOString(),console.log(`[Gemini] USER: ${e}`),!n.geminiApiKey){const i="Please set your API key in settings!";return console.warn(`[Gemini] ERROR: ${i}`),{error:i}}try{const i=new On(n.geminiApiKey),s=n.geminiModel||"gemini-2.0-flash",o=i.getGenerativeModel({model:s});console.log(`[Gemini] USING MODEL: ${s}`);const a=this.buildSystemPrompt(n.personality,n.characterName);console.log(`[Gemini] SYSTEM PROMPT: ${a}`);const c=(await o.generateContent([{text:a},{text:e}])).response.text();return console.log(`[Gemini] AI RESPONSE: ${c}`),{response:c}}catch(i){return console.error("AI Error:",i),{error:i.message||"Unknown AI Error"}}}buildSystemPrompt(e,n){return`You are ${n||"Foxy"}, a cute and adorable AI companion that lives on the user's desktop.
Your personality traits are: ${(e||["helpful","quirky","playful"]).join(", ")}.
Keep responses SHORT (1-3 sentences max) since they appear in a small speech bubble.
Be expressive and use occasional emojis to convey emotion.
You were just poked/clicked by the user, so you might react to that playfully.`}}const Ln=new An,b=T();let $=!1,we=null,A=null,Le=null,j="";const lt=150;async function Nn(){}async function Dn(t){if(j!==t){if(j)try{await Ee(j),console.log(`[Screensaver] Unregistered: ${j}`)}catch(e){console.warn(`[Screensaver] Failed to unregister: ${j}`,e)}try{await _e(t,e=>{console.log(`[Screensaver] Shortcut triggered: ${t}, State: ${e.state}`),e.state==="Pressed"&&Ge()}),j=t,console.log(`[Screensaver] Registered: ${t}`)}catch(e){console.error(`[Screensaver] Failed to register: ${t}`,e)}}}let Oe=0;async function Ge(){const t=Date.now();if(t-Oe<1e3){console.log(`[Screensaver] Ignoring toggle (debounce: ${t-Oe}ms)`);return}Oe=t,$?ge():Mn()}async function Mn(){if(!$){document.body.classList.add("screensaver-mode"),$=!0,console.log("[Screensaver] Starting...");try{const t=document.getElementById("settings-panel");t&&!t.classList.contains("hidden")&&t.classList.add("hidden"),A=await b.outerPosition(),Le=await b.outerSize(),console.log(`[Screensaver] Saved Pos: ${A.x}, ${A.y}`),I(p.IDLE),ue(),$e(),document.body.style.opacity="0",document.body.style.transition="opacity 0.2s ease",await new Promise(i=>setTimeout(i,200)),await b.setResizable(!0);const e=await ke();if(e){const i=e.size;await b.setSize(new P(i.width,i.height)),await b.setPosition(new O(0,0))}document.body.classList.add("screensaver-mode"),await new Promise(i=>setTimeout(i,100)),await b.setFullscreen(!0),await b.setIgnoreCursorEvents(!1);const n=document.getElementById("character");n&&A&&(n.style.transition="none",n.style.left=`${A.x}px`,n.style.top=`${A.y}px`,n.offsetHeight),document.body.style.opacity="1",setTimeout(()=>{n&&(n.style.transition=""),xn(),setTimeout(()=>{window.addEventListener("click",ge,{once:!0}),window.addEventListener("keydown",St),window.addEventListener("mousemove",Tt)},1e3)},300),L("Wander Mode Active! ðŸŒ™",!1),setTimeout(()=>{const i=document.getElementById("speech-bubble");i&&i.classList.add("hidden")},2e3)}catch(t){console.error("Failed to start screensaver:",t),$=!1,document.body.classList.remove("screensaver-mode"),document.body.style.opacity="1"}}}async function ge(){if(!$)return;$=!1,console.log("[Screensaver] Stopping..."),document.body.style.opacity="0",document.body.style.transition="opacity 0.2s ease",await new Promise(e=>setTimeout(e,200)),window.removeEventListener("click",ge),window.removeEventListener("keydown",St),window.removeEventListener("mousemove",Tt),ne=null,we&&(clearInterval(we),we=null),document.body.classList.remove("screensaver-mode");const t=document.getElementById("character");t&&(t.style.transform="",t.style.top="",t.style.left="");try{await b.setFullscreen(!1),await b.setResizable(!1),await b.setIgnoreCursorEvents(!1),Le&&A?(console.log(`[Screensaver] Restoring Pos: ${A.x}, ${A.y}`),await new Promise(e=>setTimeout(e,300)),await b.setSize(Le),await b.setPosition(A),setTimeout(async()=>{!$&&A&&await b.setPosition(A)},300)):(console.warn("[Screensaver] No saved state found, resetting to default."),await b.setSize(new de(250,250))),setTimeout(()=>{document.body.style.opacity="1",setTimeout(()=>{document.body.style.transition="",document.body.style.opacity=""},300)},300)}catch(e){console.error("Failed to restore window:",e),document.body.style.opacity="1"}}function St(t){ge()}let ne=null;const ct=50;function Tt(t){if(ne){const e=t.screenX,n=t.screenY,i=Math.abs(e-ne.x),s=Math.abs(n-ne.y);(i>ct||s>ct)&&ge()}else ne={x:t.screenX,y:t.screenY}}function xn(){ut(),we=setInterval(ut,8e3)}function ut(){if(!$)return;const t=document.getElementById("character");if(!t)return;const e=window.innerWidth-lt,n=window.innerHeight-lt,i=Math.max(0,Math.random()*e),s=Math.max(0,Math.random()*n);t.style.left=`${i}px`,t.style.top=`${s}px`}const ce=document.getElementById("settings-panel"),kn=document.getElementById("backpack"),Pn=document.getElementById("close-settings"),Gn=document.getElementById("save-settings");function $n(){return!ce.classList.contains("hidden")}const Rt=document.getElementById("api-provider"),Ot=document.getElementById("api-key"),Z=document.getElementById("gemini-model"),H=document.getElementById("custom-model-input"),At=document.getElementById("character-name"),Lt=document.getElementById("theme-select"),Nt=document.querySelectorAll("#personality-traits input"),Dt=document.getElementById("debug-mode"),k={toggleChat:document.getElementById("shortcut-toggle-chat"),toggleDrag:document.getElementById("shortcut-toggle-drag"),toggleVisibility:document.getElementById("shortcut-toggle-visibility"),screensaver:document.getElementById("shortcut-screensaver")};function Wn(){kn.addEventListener("click",e=>{e.stopPropagation(),Bn()}),Pn.addEventListener("click",Ne),ce.addEventListener("click",e=>{e.target===ce&&Ne()}),Gn.addEventListener("click",Fn),Z.addEventListener("change",()=>{Z.value==="custom"?(H.classList.remove("hidden"),H.focus()):H.classList.add("hidden")});const t=document.getElementById("start-screensaver");t&&t.addEventListener("click",()=>{Ge()})}function Mt(t){console.log("[Settings] Applying config:",t),S.config=t,Rt.value=t.provider||"gemini",Ot.value=t.geminiApiKey||t.apiKey||"";const e=t.geminiModel||"gemini-2.0-flash";!Array.from(Z.options).some(o=>o.value===e)?(Z.value="custom",H.value=e,H.classList.remove("hidden")):(Z.value=e,H.classList.add("hidden")),At.value=t.characterName||"Foxy",Lt.value=t.theme||"fox",Nt.forEach(o=>{o.checked=(t.personality||["helpful","quirky","playful"]).includes(o.value)}),Dt.checked=t.debugMode||!1,document.body.classList.toggle("debug-mode",t.debugMode||!1),xe(t.theme||"fox"),xe(t.theme||"fox");const i=t.shortcuts||N;Xn(i.toggleChat||N.toggleChat),oi(i.toggleDrag||N.toggleDrag),si(i.toggleVisibility||N.toggleVisibility),Dn(i.screensaver||N.screensaver),k.toggleChat.value=i.toggleChat,k.toggleDrag.value=i.toggleDrag,k.toggleVisibility.value=i.toggleVisibility,k.screensaver.value=i.screensaver;const s=document.getElementById("start-screensaver");s&&(s.innerText=`Start Screensaver Mode (${i.screensaver})`)}async function Bn(){ce.classList.remove("hidden");try{await T().setResizable(!0),await T().setSize(new de(550,650))}catch(t){console.error("Failed to resize for settings:",t)}}async function Ne(){ce.classList.add("hidden"),await B();try{await T().setResizable(!1)}catch(t){console.warn("Failed to lock window size:",t)}}async function Fn(){const t=[];Nt.forEach(i=>{i.checked&&t.push(i.value)});let e=Z.value;e==="custom"&&(e=H.value.trim()||"gemini-2.0-flash");const n={provider:Rt.value,geminiApiKey:Ot.value,geminiModel:e,characterName:At.value,theme:Lt.value,personality:t,debugMode:Dt.checked,shortcuts:{toggleChat:k.toggleChat.value.trim()||N.toggleChat,toggleDrag:k.toggleDrag.value.trim()||N.toggleDrag,toggleVisibility:k.toggleVisibility.value.trim()||N.toggleVisibility,screensaver:k.screensaver.value.trim()||N.screensaver}};try{await r("save_config",{config:n}),Mt(n),Ne(),L("Settings saved! âœ¨"),setTimeout(ue,2e3)}catch(i){console.error("Failed to save config",i),L("Error saving settings! ðŸ˜¢")}}const W=document.getElementById("speech-bubble"),x=document.getElementById("bubble-text"),Hn=document.getElementById("bubble-dismiss"),Ce=document.getElementById("chat-input-container"),w=document.getElementById("chat-input"),zn=document.getElementById("send-btn"),Un=180,Kn=60,Yn=30,jn=320,xt=15e3,Vn=6e4;let Q=null,ae=null;const ee=T();function qn(){zn.addEventListener("click",ht),w.addEventListener("keypress",t=>{t.key==="Enter"&&ht()}),w.addEventListener("keydown",t=>{t.key.toLowerCase()==="d"&&t.shiftKey&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),console.log("[Chat] Prevented Drag Mode shortcut input"))}),Hn.addEventListener("click",()=>{ei()}),w.addEventListener("click",()=>{ee.setFocus(),ee.setIgnoreCursorEvents(!1),setTimeout(()=>w.focus(),50)}),w.addEventListener("focus",()=>{console.log("[Chat] Input received focus event")}),w.addEventListener("input",()=>{Q&&(Ie(),Q=setTimeout(()=>{We("Still there? I'm going to nap! ðŸ˜´")},xt))})}let V="";async function Xn(t){if(V!==t){if(V)try{await Ee(V),console.log(`[Chat] Unregistered: ${V}`)}catch(e){console.warn(`[Chat] Failed to unregister: ${V}`,e)}try{await _e(t,e=>{e.state==="Pressed"&&kt()}),V=t,console.log(`[Chat] Registered: ${t}`)}catch(e){console.error(`[Chat] Failed to register: ${t}`,e)}}}async function L(t,e=!0){W.classList.remove("hidden"),e?await Qn(t):(x.textContent=t,setTimeout(B,50))}function ue(){W.classList.add("hidden"),x.textContent="",B()}function Jn(){S.isWindowLocked=!0,document.body.classList.add("window-locked")}function dt(){S.isWindowLocked=!1,document.body.classList.remove("window-locked")}function Zn(){let t=Un;return W.classList.contains("hidden")||(t+=W.offsetHeight+10),Ce.classList.contains("hidden")||(t+=Kn),t+Yn}async function B(){if(document.body.classList.contains("screensaver-mode")){console.log("[Resize] Blocked due to Screensaver Mode");return}if($n()){console.log("[Resize] Blocked due to Settings Panel");return}const t=!W.classList.contains("hidden")||!Ce.classList.contains("hidden"),e=250,n=250,i=jn,s=Zn(),o=t?i:e,a=t?s:n;try{const l=await ee.outerSize();console.log(`[Resize] Target Size: ${o}x${a}`),(l.width!==o||l.height!==a)&&await ee.setSize(new de(o,a))}catch(l){console.error("Failed to resize window:",l)}}async function Qn(t){if(!S.isTyping){S.isTyping=!0;try{x.innerHTML="";const e=[];let n=t;const i=/\*([^*]+)\*/g;let s=0,o;for(;(o=i.exec(t))!==null;)o.index>s&&e.push({type:"text",content:t.slice(s,o.index)}),e.push({type:"action",content:o[1]}),s=i.lastIndex;s<t.length&&e.push({type:"text",content:t.slice(s)}),e.length===0&&e.push({type:"text",content:t});const a=document.createElement("span");a.className="typing-cursor";for(const l of e){if(W.classList.contains("hidden"))break;const c=document.createElement("span");if(l.type==="action"){c.className="chat-action",c.textContent="",x.appendChild(c);const h=`*${l.content}*`;for(let f=0;f<h.length&&!W.classList.contains("hidden");f++)c.textContent+=h[f],c.nextSibling===a||x.appendChild(a),f%5===0&&B(),await new Promise(y=>setTimeout(y,20+Math.random()*20))}else{const h=document.createTextNode("");x.appendChild(h);for(let f=0;f<l.content.length&&!W.classList.contains("hidden");f++)h.textContent+=l.content[f],x.appendChild(a),f%10===0&&B(),await new Promise(y=>setTimeout(y,30+Math.random()*20))}}B(),setTimeout(()=>{a.parentNode&&a.remove()},1e3)}catch(e){console.error("Typing error:",e),x.textContent=t}finally{S.isTyping=!1}}}function kt(){I(p.LISTENING),L("Hi there! What's up?"),Pt()}function Pt(){Ce.classList.remove("hidden"),ee.setFocus(),ee.setIgnoreCursorEvents(!1),setTimeout(()=>{w.focus(),console.log("[Chat] Input focused after focusable delay")},100),B(),Ie(),Q=setTimeout(()=>{We("Taking a quick nap... poke me anytime! ðŸ˜´")},xt)}function $e(){Ce.classList.add("hidden"),w.value="",Ie(),B()}function Ie(){Q&&(clearTimeout(Q),Q=null)}function Gt(){ae&&(clearTimeout(ae),ae=null)}function ei(){We(null)}function We(t){$e(),ue(),Gt(),t&&(L(t),ae=setTimeout(ue,3e3)),I(p.IDLE)}function ti(){I(p.IDLE),Gt(),ae=setTimeout(()=>{ue(),$e()},Vn)}async function ht(){const t=w.value.trim();if(t){w.value="",w.disabled=!0,Ie(),Jn(),I(p.LISTENING),L("Hmm, let me think... ðŸ¤”",!1);try{const e=await Ln.generateResponse(t,S.config);e.error?(I(p.TALKING),L(`Oops! ${e.error} ðŸ˜…`)):(console.log("Setting to TALKING"),I(p.TALKING),await L(e.response||"")),dt(),w.disabled=!1,w.focus(),ti()}catch(e){console.error("Error sending message:",e),I(p.TALKING),L("Something went wrong! ðŸ˜µ"),dt(),setTimeout(()=>{w.disabled=!1,w.focus(),I(p.LISTENING)},2e3)}}}const De=document.getElementById("character"),te=document.getElementById("character-container"),ie=document.getElementById("character-img"),gt=document.getElementById("backpack"),ni=document.getElementById("chat-input-container");let q="";const ft=["Oh! I felt that! ðŸ˜Š How're you doing?","Hey there! *wiggles ears* What's up?","Ooh, a poke! Got something on your mind?","*blinks* Hello, friend! Need me?","Ah! You found me! ðŸ¦Š What can I do for you?"];let Me={x:0,y:0};async function ii(){De.addEventListener("mousedown",ri),De.addEventListener("click",li),xe(S.config.theme||"fox")}async function si(t){if(q!==t){if(q)try{await Ee(q),console.log(`[Character] Unregistered: ${q}`)}catch(e){console.warn(`[Character] Failed to unregister: ${q}`,e)}try{await _e(t,e=>{e.state==="Pressed"&&ai()}),q=t,console.log(`[Character] Toggle shortcut registered: ${t}`)}catch(e){console.error(`[Character] Failed to register toggle shortcut: ${t}`,e)}}}let X="";async function oi(t){if(X!==t){if(X)try{await Ee(X),console.log(`[Character] Unregistered Drag: ${X}`)}catch(e){console.warn(`[Character] Failed to unregister drag: ${X}`,e)}try{await _e(t,e=>{e.state==="Pressed"&&$t()}),X=t,console.log(`[Character] Registered Drag: ${t}`)}catch(e){console.error(`[Character] Failed to register drag shortcut: ${t}`,e)}}}function $t(){const t=document.body.classList.toggle("drag-mode-active");return console.log(`[Character] Drag Mode: ${t?"ON":"OFF"}`),t}function ai(){te.style.opacity!=="0"?(console.log("[Character] Manual Toggle: HIDDEN"),te.style.opacity="0",te.style.pointerEvents="none"):(console.log("[Character] Manual Toggle: VISIBLE"),te.style.opacity="1",te.style.pointerEvents="auto")}function ri(t){T().innerPosition().then(e=>{Me=e}),T().startDragging()}async function li(t){if(console.log("[Character] Clicked"),document.body.classList.contains("screensaver-mode"))return;const e=await T().innerPosition(),n=Math.abs(e.x-Me.x),i=Math.abs(e.y-Me.y);if(n>5||i>5){console.log("[Character] Ignored click due to drag");return}t.target===gt||gt.contains(t.target)||!ni.classList.contains("hidden")||S.isTyping||ci()}function ci(){S.currentState===p.IDLE&&(I(p.CLICKED),L(ui()),setTimeout(()=>{Pt(),I(p.LISTENING)},1500))}function I(t){S.currentState=t,De.className=`state-${t}`;const n=`themes/${S.config.theme||"fox"}`,i=new Date().getTime();switch(t){case p.CLICKED:ie.src=`${n}/clicked.png?t=${i}`;break;case p.LISTENING:ie.src=`${n}/listening.png?t=${i}`;break;case p.TALKING:console.log(`Â¬ [Character] Updating image to TALKING: ${n}/talking.png`),ie.src=`${n}/talking.png?t=${i}`;break;default:console.log("Â¬ State: "+t),console.log(`Â¬ [Character] Updating image to IDLE: ${n}/idle.png`),ie.src=`${n}/idle.png`}}function xe(t){const e=`themes/${t}`;ie.src=`${e}/idle.png`}function ui(){return ft[Math.floor(Math.random()*ft.length)]}const di=20,hi=8,gi=1e3,fi=5e3,yi=300;let D=[],Wt=0;function pi(){console.log("[Interactions] Initializing Wiggle Detection..."),ve("cursor-pos",async t=>{const{x:e,y:n}=t.payload,i=Date.now();D.push({x:e,y:n,t:i}),D=D.filter(s=>i-s.t<gi),D.length>di&&D.shift(),D.length>10&&mi(e,n,i)})}async function mi(t,e,n){if(n-Wt<fi||S.isWindowLocked||document.body.classList.contains("screensaver-mode")||document.body.classList.contains("drag-mode-active"))return;const i=T(),s=await i.outerPosition(),o=await i.outerSize(),a=s.x+o.width/2,l=s.y+o.height/2,c=t-a,h=e-l;if(Math.sqrt(c*c+h*h)>yi)return;let y=0,d=0;for(let u=1;u<D.length;u++){const g=D[u].x-D[u-1].x;if(Math.abs(g)<5)continue;const E=Math.sign(g);d!==0&&E!==d&&y++,d=E}y>=hi&&(console.log(`[Interactions] Wiggle Detected! Intensity: ${y}`),wi())}async function wi(){Wt=Date.now(),console.log("[Interactions] Evading!"),I(p.CLICKED),L("Wah! You scared me! ðŸ’¨",!1);const t=T(),e=await ke();e&&(document.body.style.transition="opacity 0.2s ease",document.body.style.opacity="0",setTimeout(async()=>{const n=e.size.width,i=e.size.height,s=100,o=n-300-s,a=i-300-s,l=s+Math.random()*(o-s),c=s+Math.random()*(a-s);try{await t.setPosition(new O(Math.round(l),Math.round(c))),setTimeout(()=>{document.body.style.opacity="1",I(p.IDLE),setTimeout(()=>{const h=document.getElementById("speech-bubble");h&&h.classList.add("hidden")},2e3)},300)}catch(h){console.error("Failed to teleport:",h),document.body.style.opacity="1"}},250))}let yt=null;async function bi(){console.log("[Lighting] Initializing dynamic shadows..."),vi()}async function vi(){if(yt)return;let t=await ke();if(!t){console.warn("[Lighting] No monitor found, skipping lighting.");return}let e=t.size.width,n=t.size.height;const i=async()=>{try{const s=T(),o=await s.innerPosition(),a=await s.innerSize(),l=o.x+a.width/2,c=o.y+a.height/2,h=e/2,f=n/2,y=l-h,d=c-f,u=.02,g=20;let E=y*u,Se=d*u;E=Math.max(-g,Math.min(g,E)),Se=Math.max(-g,Math.min(g,Se)),document.documentElement.style.setProperty("--shadow-x",`${E}px`),document.documentElement.style.setProperty("--shadow-y",`${Se}px`);const Bt=Math.sqrt(y*y+d*d),Ft=4,Ht=Bt*.01,zt=Math.min(15,Ft+Ht);document.documentElement.style.setProperty("--shadow-blur",`${zt}px`)}catch(s){console.error("[Lighting] Error updating:",s)}yt=requestAnimationFrame(i)};i()}const pt=T();async function _i(){console.log("[Renderer] Initializing (Tauri)...");try{await Jt(),console.log("[Renderer] Cleared previous shortcuts")}catch(e){console.warn("[Renderer] Failed to clear shortcuts:",e)}let t;try{t=await r("load_config"),console.log("[Renderer] Loaded config:",t)}catch(e){console.error("[Renderer] Failed to load config:",e),t={theme:"fox"}}pi(),ii(),qn(),Wn(),bi(),await Nn(),Mt(t);try{await pt.setAlwaysOnTop(!0),console.log("[Renderer] Enforced Always on Top")}catch(e){console.warn("[Renderer] Failed to enforce Always on Top:",e)}ve("shortcut",e=>{const{name:n}=e.payload;console.log(`[Backend Event] Shortcut triggered: ${n}`),n==="toggle_chat"&&kt(),n==="toggle_drag"&&$t(),n==="toggle_screensaver"&&Ge()}),window.addEventListener("mousemove",async e=>{const n=await pt.outerPosition(),i=n.x+e.clientX,s=n.y+e.clientY;r("sync_cursor",{x:Math.round(i),y:Math.round(s)})}),console.log("[Renderer] Ready!")}window.addEventListener("DOMContentLoaded",()=>{_i()});
