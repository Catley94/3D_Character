(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))d(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const L of i.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&d(L)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function d(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const o={IDLE:"idle",CLICKED:"clicked",LISTENING:"listening",TALKING:"talking"};let r={},u=null;const N=15e3;let y=!1,B=!1;const C=document.getElementById("character"),f=document.getElementById("character-img"),p=document.getElementById("speech-bubble"),g=document.getElementById("bubble-text"),M=document.getElementById("chat-input-container"),a=document.getElementById("chat-input"),j=document.getElementById("send-btn"),I=document.getElementById("backpack"),v=document.getElementById("settings-panel"),D=document.getElementById("api-provider"),H=document.getElementById("api-key"),h=document.getElementById("gemini-model"),m=document.getElementById("custom-model-input"),K=document.getElementById("character-name"),O=document.getElementById("theme-select"),W=document.querySelectorAll("#personality-traits input"),U=document.getElementById("save-settings"),J=document.getElementById("close-settings"),$=document.getElementById("debug-mode");async function Q(){r=await window.electronAPI.loadConfig(),V(r),window.electronAPI.onOpenSettings(()=>F())}function V(e){D.value=e.provider||"gemini",H.value=e.apiKey||"";const t=e.geminiModel||"gemini-2.0-flash";!Array.from(h.options).some(d=>d.value===t)?(h.value="custom",m.value=t,m.classList.remove("hidden")):(h.value=t,m.classList.add("hidden")),K.value=e.characterName||"Foxy",O.value=e.theme||"fox",W.forEach(d=>{d.checked=(e.personality||["helpful","quirky","playful"]).includes(d.value)}),$.checked=e.debugMode||!1,document.body.classList.toggle("debug-mode",e.debugMode||!1),X(e.theme||"fox")}h.addEventListener("change",()=>{h.value==="custom"?(m.classList.remove("hidden"),m.focus()):m.classList.add("hidden")});function X(e){const t=`assets/themes/${e}`;f.src=`${t}/idle.png`}function c(e){C.className=`state-${e}`;const n=`assets/themes/${r.theme||"fox"}`;switch(e){case o.CLICKED:f.src=`${n}/clicked.png`;break;case o.LISTENING:f.src=`${n}/listening.png`;break;case o.TALKING:f.src=`${n}/talking.png`;break;default:f.src=`${n}/idle.png`}}const x=["Oh! I felt that! ðŸ˜Š How're you doing?","Hey there! *wiggles ears* What's up?","Ooh, a poke! Got something on your mind?","*blinks* Hello, friend! Need me?","Ah! You found me! ðŸ¦Š What can I do for you?"];function Z(){return x[Math.floor(Math.random()*x.length)]}C.addEventListener("click",e=>{e.target===I||I.contains(e.target)||!M.classList.contains("hidden")||y||B||ee()});function ee(){c(o.CLICKED),l(Z()),setTimeout(()=>{oe(),c(o.LISTENING)},1500)}const b=450,te=50;function w(){const e=p.offsetHeight;if(!p.classList.contains("hidden")&&e>100){const t=350+e+te;window.electronAPI.setWindowSize(350,Math.max(b,t))}else window.electronAPI.setWindowSize(350,b)}function l(e,t=!0){p.classList.remove("hidden"),t?ne(e):(g.textContent=e,setTimeout(w,50))}function T(){p.classList.add("hidden"),g.textContent="",window.electronAPI.setWindowSize(350,b)}async function ne(e){if(!y){y=!0;try{g.innerHTML="";const t=document.createElement("span");t.className="typing-cursor";for(let n=0;n<e.length&&!p.classList.contains("hidden");n++)g.textContent=e.substring(0,n+1),g.appendChild(t),n%10===0&&w(),await se(30+Math.random()*20);w(),setTimeout(()=>{t.parentNode&&t.remove()},1e3)}catch(t){console.error("Typing error:",t),g.textContent=e}finally{y=!1}}}function se(e){return new Promise(t=>setTimeout(t,e))}function oe(){M.classList.remove("hidden"),a.focus(),E(),u=setTimeout(()=>{P("Taking a quick nap... poke me anytime! ðŸ˜´")},N)}function ie(){M.classList.add("hidden"),a.value="",E()}function E(){u&&(clearTimeout(u),u=null)}function P(e){ie(),T(),e&&(l(e),setTimeout(T,3e3)),c(o.IDLE)}async function Y(){const e=a.value.trim();if(e){a.value="",a.disabled=!0,E(),c(o.LISTENING),l("Hmm, let me think... ðŸ¤”",!1);try{const t=await window.electronAPI.sendMessage(e,r);t.error?(c(o.TALKING),l(`Oops! ${t.error} ðŸ˜…`)):(c(o.TALKING),await l(t.response)),a.disabled=!1,a.focus(),c(o.LISTENING),u=setTimeout(()=>{P("I'll just take a nap then! ðŸ˜´")},N)}catch(t){console.error("Error sending message:",t),c(o.TALKING),l("Something went wrong! ðŸ˜µ"),setTimeout(()=>{a.disabled=!1,a.focus(),c(o.LISTENING)},2e3)}}}j.addEventListener("click",Y);a.addEventListener("keypress",e=>{e.key==="Enter"&&Y()});a.addEventListener("input",()=>{u&&(E(),u=setTimeout(()=>{P("Still there? I'm going to nap! ðŸ˜´")},N))});let A=!1,k,S,q,R,_,z;async function ae(e){if(e.target===I||I.contains(e.target))return;A=!0,B=!1,k=e.screenX,S=e.screenY;const t=await window.electronAPI.getWindowBounds();q=t.x,R=t.y,_=t.width,z=t.height,e.preventDefault()}C.addEventListener("mousedown",ae);document.addEventListener("mousemove",e=>{if(!A)return;const t=q+(e.screenX-k),n=R+(e.screenY-S);(Math.abs(e.screenX-k)>3||Math.abs(e.screenY-S)>3)&&(B=!0),window.electronAPI.setWindowPosition(t,n,_,z)});document.addEventListener("mouseup",()=>{A=!1});function F(){v.classList.remove("hidden")}function G(){v.classList.add("hidden")}I.addEventListener("click",e=>{e.stopPropagation(),F()});J.addEventListener("click",G);U.addEventListener("click",async()=>{const e=[];W.forEach(n=>{n.checked&&e.push(n.value)});let t=h.value;t==="custom"&&(t=m.value.trim()||"gemini-2.0-flash"),r={provider:D.value,apiKey:H.value,geminiModel:t,characterName:K.value,theme:O.value,personality:e,debugMode:$.checked},await window.electronAPI.saveConfig(r),X(r.theme),document.body.classList.toggle("debug-mode",r.debugMode),G(),l("Settings saved! âœ¨"),setTimeout(T,2e3)});v.addEventListener("click",e=>{e.target===v&&G()});Q();
